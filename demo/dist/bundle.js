!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t,r){"use strict";r.d(t,"a",function(){return n});var n={keyTypeArray:/\[\s*(\d+)\s*\]+/g,params:/\{\s*(\d+)\s*\}+/g,splitQuery:/\s+in\s+/,findTemplateVars:/\{\{\s*([\[\]\$\.\_0-9a-zA-Z]+)\s*\}\}/g,splitQueryVars:/\s*,\s*/,isArraySintax:{ini:/(?=^\s*\[)/,end:/(?=\]\s*$)/},filters:{like:/\s+like\s+/,as:/\s+as\s+/},hasSelectorCss:/^(#|\.)\S/}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return RepeatHtml});var _patterns__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),RepeatHtml=function(){function RepeatHtml(e){void 0===e&&(e={}),this.REPEAT_ATTR_NAME=e.attrName||"repeat",this._filters={},this._scope=e.scope||{},this._originalElements=null,this.searchFilters(),(e.compile||void 0===e.compile)&&this.init(!1,!1)}return RepeatHtml.prototype.scope=function(e,t,r){return void 0===t?this._scope[e]:(this._scope[e]=this._scope[e]||{},this._scope[e].data=t,this._scope[e].originalData=t,"function"==typeof r?this._scope[e].funcBackAfter=r:isOfType(r,"array")?(this._scope[e].funcBackAfter=r[0],this._scope[e].funcBack=r[1]):"object"==typeof r&&(this._scope[e].funcBackAfter=r.after,this._scope[e].funcBack=r.funcBack),this.refresh(e),this._scope[e].funcBackAfter&&this._scope[e].funcBackAfter.call(this,t),this)},RepeatHtml.prototype.filter=function(e,t,r){var n=this;if(t=t.trim(),this.validateFilter(e,t))return!1;var a=t.split(_patterns__WEBPACK_IMPORTED_MODULE_0__.a.filters.as),i=a[0],s=a[1];s||(s=i,i=null);var l=document.getElementById(s.replace(/#|^%|%$/g,""));if(!l)return this;var o=/^%/g.test(s)?"^":"",_=/%$/g.test(s)?"$":"";return t=l.value,l.addEventListener("keyup",function(t){var a=t.target.value;n._scope[e].data=n._scope[e].originalData.filter(function(e){var t=new RegExp(o+a+_,"gi");if(i)return t.test(e[i]);for(var r in e)if(t.test(e[r]))return!0}),n.refresh(e,r)}),this},RepeatHtml.prototype.searchFilters=function(){var e=this,t=document.querySelectorAll("[data-filter]");if(!(t.length<=0))for(var r=null,n="",a=0;r=t[a];a++)n=r.dataset[this.REPEAT_ATTR_NAME].split(_patterns__WEBPACK_IMPORTED_MODULE_0__.a.splitQuery),r.dataset.filter.split(_patterns__WEBPACK_IMPORTED_MODULE_0__.a.splitQueryVars).forEach(function(t){e.filter(n[1],t,r)})},RepeatHtml.prototype.applyFilter=function(e){return e&&this._filters[e]?this._scope[e].data.filter(this._filters[e]):this._scope[e].data},RepeatHtml.prototype.validateFilter=function(e,t){return void 0!==e&&(!(!_patterns__WEBPACK_IMPORTED_MODULE_0__.a.filters.as.test(t)&&!_patterns__WEBPACK_IMPORTED_MODULE_0__.a.hasSelectorCss.test(t.replace(/^%|%$/g,"")))&&void 0)},RepeatHtml.prototype.refresh=function(e,t){return document.querySelectorAll("[data-"+this.REPEAT_ATTR_NAME+"]").length>0&&this.init(!1,!1),this.reRender(e,t),this},RepeatHtml.prototype.reRender=function(e,t){var r,n,a=this,i=this._originalElements,s="",l=null,o=i.length,_=document.createDocumentFragment(),c=[],p=this._scope[e];for(r=0;r<o;r++)n=i[r],t&&t.dataset.filter!==n.element.dataset.filter||(l=this.resolveQuery.call(this,n.element.dataset[this.REPEAT_ATTR_NAME])).datas&&e===l.varName&&(s=n.element.innerHTML,n.childs.forEach(function(e,t){0!==t&&n.parentElement.removeChild(e)}),n.childs.splice(1,n.childs.length),l.datas.forEach(function(e){var t,r=n.elementClone.cloneNode(!1);r.innerHTML=renderTemplate(s,((t={})[l.varsIterate]=e,t)),_.appendChild(r),n.childs.push(r),p.funcBack&&c.push([e,r])}),insertAfter(_,n.childs[0]),_=document.createDocumentFragment());e&&p.funcBack&&c.forEach(function(e){p.funcBack.apply(a,e)})},RepeatHtml.prototype.init=function(e,t){var r,n,a=this,i="[data-"+this.REPEAT_ATTR_NAME+"]",s=document.querySelectorAll(i+(t?"":" "+i)),l=null,o=null,_=0,c=document.createDocumentFragment();this._originalElements||(this._originalElements=[]);var p=function(){if(l=s[r].element||s[r],!(o=u.resolveQuery.call(u,l.dataset[u.REPEAT_ATTR_NAME])).datas)return"continue";var t=l.innerHTML,n=l.cloneNode(!0),i=document.createComment("RepeatHTML: start( "+l.dataset[u.REPEAT_ATTR_NAME]+" )");n.removeAttribute("data-"+u.REPEAT_ATTR_NAME),n.removeAttribute("data-filter"),e||(u._originalElements.push({element:l.cloneNode(!0),elementClone:n,parentElement:l.parentElement,childs:[i]}),_=u._originalElements.length),c.appendChild(i),o.datas.forEach(function(r){var i,s=n.cloneNode(!1);s.innerHTML=renderTemplate(t,((i={})[o.varsIterate]=r,i)),c.appendChild(s),e||a._originalElements[_-1].childs.push(s)}),l.parentElement.replaceChild(c,l),c=document.createDocumentFragment()},u=this;for(r=0,n=s.length;r<n;r++)p();if(document.querySelectorAll(i).length>0&&!t)return this.init(e,!0)},RepeatHtml.prototype.resolveQuery=function(e){return""!==(e=e.split(_patterns__WEBPACK_IMPORTED_MODULE_0__.a.splitQuery))[0].trim()||e[1]?{varsIterate:e[0].split(_patterns__WEBPACK_IMPORTED_MODULE_0__.a.splitQueryVars),datas:this.parseData.call(this,e[1].trim()),varName:e[1].trim()}:{varsIterate:null,datas:null,varName:null}},RepeatHtml.prototype.parseData=function(strData){return this._scope[strData]?this.applyFilter(strData):_patterns__WEBPACK_IMPORTED_MODULE_0__.a.isArraySintax.ini.test(strData)&&_patterns__WEBPACK_IMPORTED_MODULE_0__.a.isArraySintax.end.test(strData)?eval(strData):null},RepeatHtml}();function renderTemplate(e,t){return e.replace(_patterns__WEBPACK_IMPORTED_MODULE_0__.a.keyTypeArray,".$1").replace(_patterns__WEBPACK_IMPORTED_MODULE_0__.a.findTemplateVars,function(e,r){var n,a=r.split("."),i=t[a[0]];for(n=1;n<a.length;n++)i=i[a[n]];return i||e})}function insertAfter(e,t){t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e)}function isOfType(e,t){return{}.toString.call(e).match(/\s(.+)\]$/)[1].toLowerCase()===t}},function(e,t,r){"use strict";r.r(t);var n=r(1);r.d(t,"RepeatHtml",function(){return n.a})}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovLy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly8vLi9zcmMvcGF0dGVybnMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3JlcGVhdC1odG1sLnRzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsImEiLCJpIiwid2luZG93IiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsInZhbHVlIiwibiIsIl9fZXNNb2R1bGUiLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJwYXR0ZXJucyIsImtleVR5cGVBcnJheSIsInBhcmFtcyIsInNwbGl0UXVlcnkiLCJmaW5kVGVtcGxhdGVWYXJzIiwic3BsaXRRdWVyeVZhcnMiLCJpc0FycmF5U2ludGF4IiwiaW5pIiwiZW5kIiwiZmlsdGVycyIsImxpa2UiLCJhcyIsImhhc1NlbGVjdG9yQ3NzIiwiUmVwZWF0SHRtbCIsImNvbmZpZyIsInRoaXMiLCJSRVBFQVRfQVRUUl9OQU1FIiwiYXR0ck5hbWUiLCJfZmlsdGVycyIsIl9zY29wZSIsInNjb3BlIiwiX29yaWdpbmFsRWxlbWVudHMiLCJzZWFyY2hGaWx0ZXJzIiwiY29tcGlsZSIsInVuZGVmaW5lZCIsImluaXQiLCJ2YXJOYW1lIiwiZGF0YSIsImZ1bmNCYWNrcyIsIm9yaWdpbmFsRGF0YSIsImZ1bmNCYWNrQWZ0ZXIiLCJpc09mVHlwZSIsImZ1bmNCYWNrIiwiYWZ0ZXIiLCJyZWZyZXNoIiwiZmlsdGVyIiwidmFyaWFibGVOYW1lIiwiZmlsdGVyVmFsdWUiLCJlbGVtZW50IiwiX3RoaXMiLCJ0cmltIiwidmFsaWRhdGVGaWx0ZXIiLCJfZmlsdGVyIiwic3BsaXQiLCJfcGF0dGVybnNfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyIsInByb3AiLCJzZWxlY3RvciIsImVsZW0iLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwicmVwbGFjZSIsImhhc1BlcmNlbnRJbml0IiwidGVzdCIsImhhc1BlcmNlbnRFbmQiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJ0YXJnZXQiLCJwYXR0ZXJuIiwiUmVnRXhwIiwiX3Byb3AiLCJxdWVyeUZpbHRlcnMiLCJxdWVyeVNlbGVjdG9yQWxsIiwibGVuZ3RoIiwicXVlcnlSZXBlYXQiLCJkYXRhc2V0IiwiZm9yRWFjaCIsImFwcGx5RmlsdGVyIiwicmVSZW5kZXIiLCJlbGVtZW50RGF0YSIsImVsZW1lbnRzIiwiZWxlbWVudEhUTUwiLCJyZXBlYXREYXRhIiwibGVuIiwiZWxlbWVudHNSZXBlYXRDb250ZW50IiwiY3JlYXRlRG9jdW1lbnRGcmFnbWVudCIsImZ1bmNCYWNrQXJncyIsIm1vZGVsRGF0YSIsInJlc29sdmVRdWVyeSIsImRhdGFzIiwiaW5uZXJIVE1MIiwiY2hpbGRzIiwiY2hpbGQiLCJpbmRleCIsInBhcmVudEVsZW1lbnQiLCJyZW1vdmVDaGlsZCIsInNwbGljZSIsImVsZW1lbnRDbG9uIiwiZWxlbWVudENsb25lIiwiY2xvbmVOb2RlIiwicmVuZGVyVGVtcGxhdGUiLCJfYSIsInZhcnNJdGVyYXRlIiwiYXBwZW5kQ2hpbGQiLCJwdXNoIiwiaW5zZXJ0QWZ0ZXIiLCJhcmdzIiwiYXBwbHkiLCJpc1JlZnJlc2giLCJmaW5kUGFyZW50cyIsImxlbkVsZW1lbnRzIiwidGhpc18xIiwiZWxlbWVudEh0bWwiLCJlbGVtZW50Q29weSIsImNvbW1lbnRTdGFydCIsImNyZWF0ZUNvbW1lbnQiLCJyZW1vdmVBdHRyaWJ1dGUiLCJlbGVtZW50Q2xvbmVkIiwicmVwbGFjZUNoaWxkIiwicXVlcnkiLCJwYXJzZURhdGEiLCJzdHJEYXRhIiwiZXZhbCIsInRlbXBsYXRlIiwiZmluZCIsImtleSIsImlkeCIsInBhcnRzS2V5IiwiZmluZGVyIiwiaW5zZXJ0RWxlbWVudCIsIm5leHRTaWJsaW5nIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSIsImNvbXBhcmUiLCJ0b1N0cmluZyIsIm1hdGNoIiwidG9Mb3dlckNhc2UiXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBQ0Esb0JBQUFDLFNBQUEsaUJBQUFDLE9BQ0FBLE9BQUFELFFBQUFELFNBQ0Esc0JBQUFHLGVBQUFDLElBQ0FELFVBQUFILE9BQ0EsQ0FDQSxJQUFBSyxFQUFBTCxJQUNBLFFBQUFNLEtBQUFELEdBQUEsaUJBQUFKLGdCQUFBRixHQUFBTyxHQUFBRCxFQUFBQyxJQVBBLENBU0NDLE9BQUEsV0FDRCxtQkNUQSxJQUFBQyxLQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBVCxRQUdBLElBQUFDLEVBQUFNLEVBQUFFLElBQ0FKLEVBQUFJLEVBQ0FDLEdBQUEsRUFDQVYsWUFVQSxPQU5BVyxFQUFBRixHQUFBRyxLQUFBWCxFQUFBRCxRQUFBQyxJQUFBRCxRQUFBUSxHQUdBUCxFQUFBUyxHQUFBLEVBR0FULEVBQUFELFFBMkNBLE9BdENBUSxFQUFBSyxFQUFBRixFQUdBSCxFQUFBTSxFQUFBUCxFQUdBQyxFQUFBTyxFQUFBLFNBQUFmLEVBQUFnQixFQUFBQyxHQUNBVCxFQUFBVSxFQUFBbEIsRUFBQWdCLElBQ0FHLE9BQUFDLGVBQUFwQixFQUFBZ0IsR0FDQUssY0FBQSxFQUNBQyxZQUFBLEVBQ0FDLElBQUFOLEtBTUFULEVBQUFnQixFQUFBLFNBQUF4QixHQUNBbUIsT0FBQUMsZUFBQXBCLEVBQUEsY0FBaUR5QixPQUFBLEtBSWpEakIsRUFBQWtCLEVBQUEsU0FBQXpCLEdBQ0EsSUFBQWdCLEVBQUFoQixLQUFBMEIsV0FDQSxXQUEyQixPQUFBMUIsRUFBQSxTQUMzQixXQUFpQyxPQUFBQSxHQUVqQyxPQURBTyxFQUFBTyxFQUFBRSxFQUFBLElBQUFBLEdBQ0FBLEdBSUFULEVBQUFVLEVBQUEsU0FBQVUsRUFBQUMsR0FBc0QsT0FBQVYsT0FBQVcsVUFBQUMsZUFBQW5CLEtBQUFnQixFQUFBQyxJQUd0RHJCLEVBQUF3QixFQUFBLEdBSUF4QixJQUFBeUIsRUFBQSxrRUNuRU8sSUFBTUMsR0FDVEMsYUFBYyxvQkFDZEMsT0FBUSxvQkFDUkMsV0FBWSxXQUNaQyxpQkFBa0IsMENBQ2xCQyxlQUFnQixVQUNoQkMsZUFDSUMsSUFBSyxhQUNMQyxJQUFLLGNBRVRDLFNBQ0lDLEtBQU0sYUFDTkMsR0FBSSxZQUVSQyxlQUFnQixtT0NOcEJDLFdBQUEsV0FNSSxTQUFBQSxXQUFZQyxRQUFBLElBQUFBLFVBQ1JDLEtBQUtDLGlCQUFtQkYsRUFBT0csVUFBWSxTQUMzQ0YsS0FBS0csWUFDTEgsS0FBS0ksT0FBU0wsRUFBT00sVUFDckJMLEtBQUtNLGtCQUFvQixLQUV6Qk4sS0FBS08saUJBRURSLEVBQU9TLGNBQThCQyxJQUFuQlYsRUFBT1MsVUFDekJSLEtBQUtVLE1BQUssR0FBTyxHQXNYN0IsT0F6V0laLFdBQUFqQixVQUFBd0IsTUFBQSxTQUFNTSxFQUFpQkMsRUFBTUMsR0FDekIsWUFBYUosSUFBVEcsRUFDT1osS0FBS0ksT0FBT08sSUFHdkJYLEtBQUtJLE9BQU9PLEdBQVdYLEtBQUtJLE9BQU9PLE9BQ25DWCxLQUFLSSxPQUFPTyxHQUFTQyxLQUFPQSxFQUM1QlosS0FBS0ksT0FBT08sR0FBU0csYUFBZUYsRUFFWCxtQkFBZEMsRUFDUGIsS0FBS0ksT0FBT08sR0FBU0ksY0FBZ0JGLEVBQzlCRyxTQUFTSCxFQUFXLFVBQzNCYixLQUFLSSxPQUFPTyxHQUFTSSxjQUFnQkYsRUFBVSxHQUMvQ2IsS0FBS0ksT0FBT08sR0FBU00sU0FBV0osRUFBVSxJQUNkLGlCQUFkQSxJQUNkYixLQUFLSSxPQUFPTyxHQUFTSSxjQUFnQkYsRUFBVUssTUFDL0NsQixLQUFLSSxPQUFPTyxHQUFTTSxTQUFXSixFQUFVSSxVQUc5Q2pCLEtBQUttQixRQUFRUixHQUVUWCxLQUFLSSxPQUFPTyxHQUFTSSxlQUNyQmYsS0FBS0ksT0FBT08sR0FBU0ksY0FBY3BELEtBQUtxQyxLQUFNWSxHQUczQ1osT0FTWEYsV0FBQWpCLFVBQUF1QyxPQUFBLFNBQU9DLEVBQXNCQyxFQUFhQyxHQUExQyxJQUFBQyxFQUFBeEIsS0FHSSxHQUZBc0IsRUFBY0EsRUFBWUcsT0FFdEJ6QixLQUFLMEIsZUFBZUwsRUFBY0MsR0FDbEMsT0FBTyxFQUdYLElBQUlLLEVBQVVMLEVBQVlNLE1BQU1DLHVDQUFBLEVBQVNuQyxRQUFRRSxJQUU3Q2tDLEVBQU9ILEVBQVEsR0FDZkksRUFBV0osRUFBUSxHQUVsQkksSUFDREEsRUFBV0QsRUFDWEEsRUFBTyxNQUdYLElBQUlFLEVBQU9DLFNBQVNDLGVBQWVILEVBQVNJLFFBQVEsV0FBWSxLQUVoRSxJQUFLSCxFQUNELE9BQU9oQyxLQUdYLElBQUlvQyxFQUFpQixNQUFNQyxLQUFLTixHQUFZLElBQU0sR0FDOUNPLEVBQWdCLE1BQU1ELEtBQUtOLEdBQVksSUFBTSxHQTZCakQsT0EzQkFULEVBQWNVLEVBQUt4RCxNQUVuQndELEVBQUtPLGlCQUFpQixRQUFTLFNBQUFDLEdBQzNCLElBQUloRSxFQUFRZ0UsRUFBTUMsT0FBT2pFLE1BRXpCZ0QsRUFBS3BCLE9BQU9pQixHQUFjVCxLQUFPWSxFQUFLcEIsT0FDbENpQixHQUNGUCxhQUFhTSxPQUFPLFNBQVNSLEdBQzNCLElBQUk4QixFQUFVLElBQUlDLE9BQ2RQLEVBQWlCNUQsRUFBUThELEVBQ3pCLE1BR0osR0FBSVIsRUFDQSxPQUFPWSxFQUFRTCxLQUFLekIsRUFBS2tCLElBRzdCLElBQUssSUFBTWMsS0FBU2hDLEVBQ2hCLEdBQUk4QixFQUFRTCxLQUFLekIsRUFBS2dDLElBQ2xCLE9BQU8sSUFLbkJwQixFQUFLTCxRQUFRRSxFQUFjRSxLQUd4QnZCLE1BR1hGLFdBQUFqQixVQUFBMEIsY0FBQSxlQUFBaUIsRUFBQXhCLEtBQ1E2QyxFQUFlWixTQUFTYSxpQkFBaUIsaUJBRTdDLEtBQUlELEVBQWFFLFFBQVUsR0FPM0IsSUFIQSxJQUFJeEIsRUFBVSxLQUNWeUIsRUFBYyxHQUVUNUYsRUFBSSxFQUFJbUUsRUFBVXNCLEVBQWF6RixHQUFLQSxJQUN6QzRGLEVBQWN6QixFQUFRMEIsUUFBUWpELEtBQUtDLGtCQUFrQjJCLE1BQ2pEQyx1Q0FBQSxFQUFTekMsWUFHYm1DLEVBQVEwQixRQUFRN0IsT0FDWFEsTUFBTUMsdUNBQUEsRUFBU3ZDLGdCQUNmNEQsUUFBUSxTQUFBOUIsR0FDTEksRUFBS0osT0FBTzRCLEVBQVksR0FBSTVCLEVBQVFHLE1BVXBEekIsV0FBQWpCLFVBQUFzRSxZQUFBLFNBQVl4QyxHQUNSLE9BQUtBLEdBQVlYLEtBQUtHLFNBQVNRLEdBSXhCWCxLQUFLSSxPQUFPTyxHQUFTQyxLQUFLUSxPQUFPcEIsS0FBS0csU0FBU1EsSUFIM0NYLEtBQUtJLE9BQU9PLEdBQVNDLE1BTXBDZCxXQUFBakIsVUFBQTZDLGVBQUEsU0FBZUwsRUFBc0JDLEdBQ2pDLFlBQXFCYixJQUFqQlksT0FLQ1EsdUNBQUEsRUFBU25DLFFBQVFFLEdBQUd5QyxLQUFLZixLQUN6Qk8sdUNBQUEsRUFBU2hDLGVBQWV3QyxLQUFLZixFQUFZYSxRQUFRLFNBQVUsWUFGaEUsSUFhSnJDLFdBQUFqQixVQUFBc0MsUUFBQSxTQUFRUixFQUFTWSxHQVliLE9BVklVLFNBQVNhLGlCQUFpQixTQUFXOUMsS0FBS0MsaUJBQW1CLEtBQ3hEOEMsT0FBUyxHQUdkL0MsS0FBS1UsTUFBSyxHQUFPLEdBR3JCVixLQUFLb0QsU0FBU3pDLEVBQVNZLEdBR2hCdkIsTUFRWEYsV0FBQWpCLFVBQUF1RSxTQUFBLFNBQVN6QyxFQUFTWSxHQUFsQixJQUlRbkUsRUFFQWlHLEVBTlI3QixFQUFBeEIsS0FDUXNELEVBQVd0RCxLQUFLTSxrQkFDaEJpRCxFQUFjLEdBQ2RDLEVBQWEsS0FFYkMsRUFBTUgsRUFBU1AsT0FFZlcsRUFBd0J6QixTQUFTMEIseUJBRWpDQyxLQUNBQyxFQUFZN0QsS0FBS0ksT0FBT08sR0FFNUIsSUFBS3ZELEVBQUksRUFBR0EsRUFBSXFHLEVBQUtyRyxJQUNqQmlHLEVBQWNDLEVBQVNsRyxHQUduQm1FLEdBQ0FBLEVBQVEwQixRQUFRN0IsU0FBV2lDLEVBQVk5QixRQUFRMEIsUUFBUTdCLFNBSzNEb0MsRUFBYXhELEtBQUs4RCxhQUFhbkcsS0FDM0JxQyxLQUNBcUQsRUFBWTlCLFFBQVEwQixRQUFRakQsS0FBS0Msb0JBR3JCOEQsT0FBU3BELElBQVk2QyxFQUFXN0MsVUFJaEQ0QyxFQUFjRixFQUFZOUIsUUFBUXlDLFVBRWxDWCxFQUFZWSxPQUFPZixRQUFRLFNBQVNnQixFQUFPQyxHQUN6QixJQUFWQSxHQUlKZCxFQUFZZSxjQUFjQyxZQUFZSCxLQUcxQ2IsRUFBWVksT0FBT0ssT0FBTyxFQUFHakIsRUFBWVksT0FBT2xCLFFBRWhEUyxFQUFXTyxNQUFNYixRQUFRLFNBQUF0QyxHQUNyQixNQUFJMkQsRUFBY2xCLEVBQVltQixhQUFhQyxXQUFVLEdBRXJERixFQUFZUCxVQUFZVSxlQUFlbkIsSUFBV29CLE1BQzdDbkIsRUFBV29CLGFBQWNoRSxNQUc5QjhDLEVBQXNCbUIsWUFBWU4sR0FDbENsQixFQUFZWSxPQUFPYSxLQUFLUCxHQUVwQlYsRUFBVTVDLFVBQ1YyQyxFQUFha0IsTUFBTWxFLEVBQU0yRCxNQUlqQ1EsWUFBWXJCLEVBQXVCTCxFQUFZWSxPQUFPLElBQ3REUCxFQUF3QnpCLFNBQVMwQiwwQkFHL0JoRCxHQUFXa0QsRUFBVTVDLFVBQ3ZCMkMsRUFBYVYsUUFBUSxTQUFBOEIsR0FDakJuQixFQUFVNUMsU0FBU2dFLE1BQU16RCxFQUFNd0QsTUFVM0NsRixXQUFBakIsVUFBQTZCLEtBQUEsU0FBS3dFLEVBQVdDLEdBQWhCLElBUVEvSCxFQUNBcUcsRUFUUmpDLEVBQUF4QixLQUNRK0IsRUFBVyxTQUFXL0IsS0FBS0MsaUJBQW1CLElBRTlDcUQsRUFBV3JCLFNBQVNhLGlCQUNwQmYsR0FBWW9ELEVBQWMsR0FBSyxJQUFNcEQsSUFFckNSLEVBQVUsS0FDVmlDLEVBQWEsS0FHYjRCLEVBQWMsRUFDZDFCLEVBQXdCekIsU0FBUzBCLHlCQUVoQzNELEtBQUtNLG9CQUNOTixLQUFLTSx1Q0FXTCxHQVBBaUIsRUFBVStCLEVBQVNsRyxHQUFHbUUsU0FBVytCLEVBQVNsRyxLQUUxQ29HLEVBQWE2QixFQUFLdkIsYUFBYW5HLEtBQUkwSCxFQUUvQjlELEVBQVEwQixRQUFRb0MsRUFBS3BGLG9CQUdUOEQsdUJBSWhCLElBQUl1QixFQUFjL0QsRUFBUXlDLFVBRXRCdUIsRUFBY2hFLEVBQVFrRCxXQUFVLEdBQ2hDZSxFQUFldkQsU0FBU3dELGNBQ3BCLHNCQUNJbEUsRUFBUTBCLFFBQVFvQyxFQUFLcEYsa0JBQ3JCLE1BR1pzRixFQUFZRyxnQkFBZ0IsUUFBVUwsRUFBS3BGLGtCQUMzQ3NGLEVBQVlHLGdCQUFnQixlQUV2QlIsSUFFREcsRUFBSy9FLGtCQUFrQndFLE1BQ25CdkQsUUFBU0EsRUFBUWtELFdBQVUsR0FDM0JELGFBQWNlLEVBQ2RuQixjQUFlN0MsRUFBUTZDLGNBQ3ZCSCxRQUFTdUIsS0FHYkosRUFBY0MsRUFBSy9FLGtCQUFrQnlDLFFBR3pDVyxFQUFzQm1CLFlBQVlXLEdBR2xDaEMsRUFBV08sTUFBTWIsUUFBUSxTQUFBdEMsR0FDckIsTUFBSStFLEVBQWdCSixFQUFZZCxXQUFVLEdBRTFDa0IsRUFBYzNCLFVBQVlVLGVBQWVZLElBQVdYLE1BQy9DbkIsRUFBV29CLGFBQWNoRSxNQUc5QjhDLEVBQXNCbUIsWUFBWWMsR0FFN0JULEdBQ0QxRCxFQUFLbEIsa0JBQWtCOEUsRUFBYyxHQUFHbkIsT0FBT2EsS0FDM0NhLEtBS1pwRSxFQUFRNkMsY0FBY3dCLGFBQWFsQyxFQUF1Qm5DLEdBQzFEbUMsRUFBd0J6QixTQUFTMEIsaUNBeERyQyxJQUFLdkcsRUFBSSxFQUFHcUcsRUFBTUgsRUFBU1AsT0FBUTNGLEVBQUlxRyxFQUFLckcsUUEyRDVDLEdBQUk2RSxTQUFTYSxpQkFBaUJmLEdBQVVnQixPQUFTLElBQU1vQyxFQUNuRCxPQUFPbkYsS0FBS1UsS0FBS3dFLEdBQVcsSUFTcENwRixXQUFBakIsVUFBQWlGLGFBQUEsU0FBYStCLEdBR1QsTUFBd0IsTUFGeEJBLEVBQVFBLEVBQU1qRSxNQUFNQyx1Q0FBQSxFQUFTekMsYUFFbkIsR0FBR3FDLFFBQWtCb0UsRUFBTSxJQVNqQ2pCLFlBQWFpQixFQUFNLEdBQUdqRSxNQUFNQyx1Q0FBQSxFQUFTdkMsZ0JBQ3JDeUUsTUFBTy9ELEtBQUs4RixVQUFVbkksS0FBS3FDLEtBQU02RixFQUFNLEdBQUdwRSxRQUMxQ2QsUUFBU2tGLEVBQU0sR0FBR3BFLFNBVGRtRCxZQUFhLEtBQ2JiLE1BQU8sS0FDUHBELFFBQVMsT0FnQnJCYixXQUFBakIsVUFBQWlILFVBQUEsU0FBVUMsU0FDTixPQUFJL0YsS0FBS0ksT0FBTzJGLFNBQ0wvRixLQUFLbUQsWUFBWTRDLFNBSXhCbEUsdUNBQUEsRUFBU3RDLGNBQWNDLElBQUk2QyxLQUFLMEQsVUFDaENsRSx1Q0FBQSxFQUFTdEMsY0FBY0UsSUFBSTRDLEtBQUswRCxTQUV6QkMsS0FBS0QsU0FHVCxNQUVmakcsV0FyWUEsR0E0WUEsU0FBQTRFLGVBQXdCdUIsRUFBVXJGLEdBQzlCLE9BQU9xRixFQUNGOUQsUUFBUU4sdUNBQUEsRUFBUzNDLGFBQWMsT0FDL0JpRCxRQUFRTix1Q0FBQSxFQUFTeEMsaUJBQWtCLFNBQUM2RyxFQUFNQyxHQUN2QyxJQUVJQyxFQUZBQyxFQUFXRixFQUFJdkUsTUFBTSxLQUNyQjBFLEVBQVMxRixFQUFLeUYsRUFBUyxJQUczQixJQUFLRCxFQUFNLEVBQUdBLEVBQU1DLEVBQVN0RCxPQUFRcUQsSUFDakNFLEVBQVNBLEVBQU9ELEVBQVNELElBRzdCLE9BQUlFLEdBSUdKLElBT25CLFNBQUFuQixZQUFxQndCLEVBQWVoRixHQUM1QkEsRUFBUWlGLFlBQ1JqRixFQUFRa0YsV0FBV0MsYUFBYUgsRUFBZWhGLEVBQVFpRixhQUkzRGpGLEVBQVFrRixXQUFXNUIsWUFBWTBCLEdBR25DLFNBQUF2RixTQUFrQkosRUFBTStGLEdBQ3BCLFNBQ09DLFNBQ0VqSixLQUFLaUQsR0FDTGlHLE1BQU0sYUFBYSxHQUNuQkMsZ0JBQWtCSCIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXSwgZmFjdG9yeSk7XG5cdGVsc2Uge1xuXHRcdHZhciBhID0gZmFjdG9yeSgpO1xuXHRcdGZvcih2YXIgaSBpbiBhKSAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnID8gZXhwb3J0cyA6IHJvb3QpW2ldID0gYVtpXTtcblx0fVxufSkod2luZG93LCBmdW5jdGlvbigpIHtcbnJldHVybiAiLCIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHtcbiBcdFx0XHRcdGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gXHRcdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxuIFx0XHRcdFx0Z2V0OiBnZXR0ZXJcbiBcdFx0XHR9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDIpO1xuIiwiZXhwb3J0IGNvbnN0IHBhdHRlcm5zID0ge1xuICAgIGtleVR5cGVBcnJheTogL1xcW1xccyooXFxkKylcXHMqXFxdKy9nLFxuICAgIHBhcmFtczogL1xce1xccyooXFxkKylcXHMqXFx9Ky9nLFxuICAgIHNwbGl0UXVlcnk6IC9cXHMraW5cXHMrLyxcbiAgICBmaW5kVGVtcGxhdGVWYXJzOiAvXFx7XFx7XFxzKihbXFxbXFxdXFwkXFwuXFxfMC05YS16QS1aXSspXFxzKlxcfVxcfS9nLFxuICAgIHNwbGl0UXVlcnlWYXJzOiAvXFxzKixcXHMqLyxcbiAgICBpc0FycmF5U2ludGF4OiB7XG4gICAgICAgIGluaTogLyg/PV5cXHMqXFxbKS8sXG4gICAgICAgIGVuZDogLyg/PVxcXVxccyokKS9cbiAgICB9LFxuICAgIGZpbHRlcnM6IHtcbiAgICAgICAgbGlrZTogL1xccytsaWtlXFxzKy8sXG4gICAgICAgIGFzOiAvXFxzK2FzXFxzKy9cbiAgICB9LFxuICAgIGhhc1NlbGVjdG9yQ3NzOiAvXigjfFxcLilcXFMvXG59O1xuIiwiaW1wb3J0IHsgcGF0dGVybnMgfSBmcm9tICcuL3BhdHRlcm5zJztcblxuZGVjbGFyZSBsZXQgZG9jdW1lbnQ7XG5cbi8qKlxuICogQGNvbnN0cnVjdG9yIFJlcGVhdEhUTUxcbiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgLSBDb25maWd1cmFjaW9uIGluaWNpYWwgcGFyYSBsYSBpbnN0YW5jaWFcbiAqL1xuZXhwb3J0IGNsYXNzIFJlcGVhdEh0bWwge1xuICAgIF9vcmlnaW5hbEVsZW1lbnRzOiBhbnk7XG4gICAgX3Njb3BlOiBhbnk7XG4gICAgX2ZpbHRlcnM7XG4gICAgUkVQRUFUX0FUVFJfTkFNRTogYW55O1xuXG4gICAgY29uc3RydWN0b3IoY29uZmlnOiBhbnkgPSB7fSkge1xuICAgICAgICB0aGlzLlJFUEVBVF9BVFRSX05BTUUgPSBjb25maWcuYXR0ck5hbWUgfHwgJ3JlcGVhdCc7XG4gICAgICAgIHRoaXMuX2ZpbHRlcnMgPSB7fTtcbiAgICAgICAgdGhpcy5fc2NvcGUgPSBjb25maWcuc2NvcGUgfHwge307XG4gICAgICAgIHRoaXMuX29yaWdpbmFsRWxlbWVudHMgPSBudWxsO1xuXG4gICAgICAgIHRoaXMuc2VhcmNoRmlsdGVycygpO1xuXG4gICAgICAgIGlmIChjb25maWcuY29tcGlsZSB8fCBjb25maWcuY29tcGlsZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmluaXQoZmFsc2UsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE1ldG9kbyBkZSBlbnRyYWRhIG8gc2FsaWRhIGRlIGRhdG9zIGRlbCBfc2NvcGVcbiAgICAgKiBAcHVibGljXG4gICAgICogQG1ldGhvZFxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHZhck5hbWUgLSBOb21icmUgZGVsIGRhdG8gYSBhbG1hY2VuYXIgZGVudHJvIGRlbCBzY29wZVxuICAgICAqIEBwYXJhbSB7YW55W119IGRhdGEgLSBJbmZvcm1hY2lvbiBvIGRhdG9zIGEgYWxtYWNlbmFyXG4gICAgICogQHBhcmFtIHtPYmplY3R8RnVuY3Rpb258QXJyYXl9IGZ1bmNCYWNrcyAtIEZ1bmNpb25lcyBxdWUgc2UgZWplY3V0YXJhbiBhbCBhY3R1YWxpemFyIGVsIG1vZGVsbyBkZSBkYXRvc1xuICAgICAqL1xuICAgIHNjb3BlKHZhck5hbWU6IHN0cmluZywgZGF0YSwgZnVuY0JhY2tzPykge1xuICAgICAgICBpZiAoZGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc2NvcGVbdmFyTmFtZV07XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9zY29wZVt2YXJOYW1lXSA9IHRoaXMuX3Njb3BlW3Zhck5hbWVdIHx8IHt9O1xuICAgICAgICB0aGlzLl9zY29wZVt2YXJOYW1lXS5kYXRhID0gZGF0YTtcbiAgICAgICAgdGhpcy5fc2NvcGVbdmFyTmFtZV0ub3JpZ2luYWxEYXRhID0gZGF0YTtcblxuICAgICAgICBpZiAodHlwZW9mIGZ1bmNCYWNrcyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgdGhpcy5fc2NvcGVbdmFyTmFtZV0uZnVuY0JhY2tBZnRlciA9IGZ1bmNCYWNrcztcbiAgICAgICAgfSBlbHNlIGlmIChpc09mVHlwZShmdW5jQmFja3MsICdhcnJheScpKSB7XG4gICAgICAgICAgICB0aGlzLl9zY29wZVt2YXJOYW1lXS5mdW5jQmFja0FmdGVyID0gZnVuY0JhY2tzWzBdO1xuICAgICAgICAgICAgdGhpcy5fc2NvcGVbdmFyTmFtZV0uZnVuY0JhY2sgPSBmdW5jQmFja3NbMV07XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGZ1bmNCYWNrcyA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIHRoaXMuX3Njb3BlW3Zhck5hbWVdLmZ1bmNCYWNrQWZ0ZXIgPSBmdW5jQmFja3MuYWZ0ZXI7XG4gICAgICAgICAgICB0aGlzLl9zY29wZVt2YXJOYW1lXS5mdW5jQmFjayA9IGZ1bmNCYWNrcy5mdW5jQmFjaztcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucmVmcmVzaCh2YXJOYW1lKTtcblxuICAgICAgICBpZiAodGhpcy5fc2NvcGVbdmFyTmFtZV0uZnVuY0JhY2tBZnRlcikge1xuICAgICAgICAgICAgdGhpcy5fc2NvcGVbdmFyTmFtZV0uZnVuY0JhY2tBZnRlci5jYWxsKHRoaXMsIGRhdGEpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHthbnl9IHZhcmlhYmxlTmFtZVxuICAgICAqIEBwYXJhbSB7YW55fSBmaWx0ZXJWYWx1ZVxuICAgICAqIEBwYXJhbSB7YW55fSBlbGVtZW50XG4gICAgICogQHJldHVybnNcbiAgICAgKi9cbiAgICBmaWx0ZXIodmFyaWFibGVOYW1lOiBzdHJpbmcsIGZpbHRlclZhbHVlLCBlbGVtZW50KSB7XG4gICAgICAgIGZpbHRlclZhbHVlID0gZmlsdGVyVmFsdWUudHJpbSgpO1xuXG4gICAgICAgIGlmICh0aGlzLnZhbGlkYXRlRmlsdGVyKHZhcmlhYmxlTmFtZSwgZmlsdGVyVmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgX2ZpbHRlciA9IGZpbHRlclZhbHVlLnNwbGl0KHBhdHRlcm5zLmZpbHRlcnMuYXMpO1xuXG4gICAgICAgIGxldCBwcm9wID0gX2ZpbHRlclswXTtcbiAgICAgICAgbGV0IHNlbGVjdG9yID0gX2ZpbHRlclsxXTtcblxuICAgICAgICBpZiAoIXNlbGVjdG9yKSB7XG4gICAgICAgICAgICBzZWxlY3RvciA9IHByb3A7XG4gICAgICAgICAgICBwcm9wID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBlbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2VsZWN0b3IucmVwbGFjZSgvI3xeJXwlJC9nLCAnJykpO1xuXG4gICAgICAgIGlmICghZWxlbSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgaGFzUGVyY2VudEluaXQgPSAvXiUvZy50ZXN0KHNlbGVjdG9yKSA/ICdeJyA6ICcnO1xuICAgICAgICBsZXQgaGFzUGVyY2VudEVuZCA9IC8lJC9nLnRlc3Qoc2VsZWN0b3IpID8gJyQnIDogJyc7XG5cbiAgICAgICAgZmlsdGVyVmFsdWUgPSBlbGVtLnZhbHVlOyAvL3BhcmEgbGxhbWFybG8gdW5hIHByaW1lcmEgdmV6XG5cbiAgICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGV2ZW50ID0+IHtcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IGV2ZW50LnRhcmdldC52YWx1ZTtcblxuICAgICAgICAgICAgdGhpcy5fc2NvcGVbdmFyaWFibGVOYW1lXS5kYXRhID0gdGhpcy5fc2NvcGVbXG4gICAgICAgICAgICAgICAgdmFyaWFibGVOYW1lXG4gICAgICAgICAgICBdLm9yaWdpbmFsRGF0YS5maWx0ZXIoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIGxldCBwYXR0ZXJuID0gbmV3IFJlZ0V4cChcbiAgICAgICAgICAgICAgICAgICAgaGFzUGVyY2VudEluaXQgKyB2YWx1ZSArIGhhc1BlcmNlbnRFbmQsXG4gICAgICAgICAgICAgICAgICAgICdnaSdcbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgaWYgKHByb3ApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhdHRlcm4udGVzdChkYXRhW3Byb3BdKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IF9wcm9wIGluIGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhdHRlcm4udGVzdChkYXRhW19wcm9wXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMucmVmcmVzaCh2YXJpYWJsZU5hbWUsIGVsZW1lbnQpO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBzZWFyY2hGaWx0ZXJzKCkge1xuICAgICAgICBsZXQgcXVlcnlGaWx0ZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtZmlsdGVyXScpO1xuXG4gICAgICAgIGlmIChxdWVyeUZpbHRlcnMubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBlbGVtZW50ID0gbnVsbDtcbiAgICAgICAgbGV0IHF1ZXJ5UmVwZWF0ID0gJyc7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IChlbGVtZW50ID0gcXVlcnlGaWx0ZXJzW2ldKTsgaSsrKSB7XG4gICAgICAgICAgICBxdWVyeVJlcGVhdCA9IGVsZW1lbnQuZGF0YXNldFt0aGlzLlJFUEVBVF9BVFRSX05BTUVdLnNwbGl0KFxuICAgICAgICAgICAgICAgIHBhdHRlcm5zLnNwbGl0UXVlcnlcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuZGF0YXNldC5maWx0ZXJcbiAgICAgICAgICAgICAgICAuc3BsaXQocGF0dGVybnMuc3BsaXRRdWVyeVZhcnMpXG4gICAgICAgICAgICAgICAgLmZvckVhY2goZmlsdGVyID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWx0ZXIocXVlcnlSZXBlYXRbMV0sIGZpbHRlciwgZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaWx0cmFyIGxhIGxpc3RhIGRlIGRhdG9zIGRlcGVuZGllbmRvIGRlbCBwYXJhbWV0cm8gZGFkb1xuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAbWV0aG9kXG4gICAgICovXG4gICAgYXBwbHlGaWx0ZXIodmFyTmFtZSkge1xuICAgICAgICBpZiAoIXZhck5hbWUgfHwgIXRoaXMuX2ZpbHRlcnNbdmFyTmFtZV0pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zY29wZVt2YXJOYW1lXS5kYXRhO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuX3Njb3BlW3Zhck5hbWVdLmRhdGEuZmlsdGVyKHRoaXMuX2ZpbHRlcnNbdmFyTmFtZV0pO1xuICAgIH1cblxuICAgIHZhbGlkYXRlRmlsdGVyKHZhcmlhYmxlTmFtZTogc3RyaW5nLCBmaWx0ZXJWYWx1ZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh2YXJpYWJsZU5hbWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgIXBhdHRlcm5zLmZpbHRlcnMuYXMudGVzdChmaWx0ZXJWYWx1ZSkgJiZcbiAgICAgICAgICAgICFwYXR0ZXJucy5oYXNTZWxlY3RvckNzcy50ZXN0KGZpbHRlclZhbHVlLnJlcGxhY2UoL14lfCUkL2csICcnKSlcbiAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBcGxpY2FyIGFjY2lvbiBkZSByZXBldGlyXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBtZXRob2RcbiAgICAgKi9cbiAgICByZWZyZXNoKHZhck5hbWUsIGVsZW1lbnQ/KSB7XG4gICAgICAgIGxldCBoYXNEYXRhUmVwZWF0QXR0cmlidXRlID1cbiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLScgKyB0aGlzLlJFUEVBVF9BVFRSX05BTUUgKyAnXScpXG4gICAgICAgICAgICAgICAgLmxlbmd0aCA+IDA7XG5cbiAgICAgICAgaWYgKGhhc0RhdGFSZXBlYXRBdHRyaWJ1dGUpIHtcbiAgICAgICAgICAgIHRoaXMuaW5pdChmYWxzZSwgZmFsc2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yZVJlbmRlcih2YXJOYW1lLCBlbGVtZW50KTtcblxuICAgICAgICAvL2NsZWFyKCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlcGl0YWRvIGRlIGxvcyBkYXRvc1xuICAgICAqIEBwcml2YXRlXG4gICAgICogQG1ldGhvZFxuICAgICAqL1xuICAgIHJlUmVuZGVyKHZhck5hbWUsIGVsZW1lbnQpIHtcbiAgICAgICAgbGV0IGVsZW1lbnRzID0gdGhpcy5fb3JpZ2luYWxFbGVtZW50cztcbiAgICAgICAgbGV0IGVsZW1lbnRIVE1MID0gJyc7XG4gICAgICAgIGxldCByZXBlYXREYXRhID0gbnVsbDtcbiAgICAgICAgbGV0IGk7XG4gICAgICAgIGxldCBsZW4gPSBlbGVtZW50cy5sZW5ndGg7XG4gICAgICAgIGxldCBlbGVtZW50RGF0YTtcbiAgICAgICAgbGV0IGVsZW1lbnRzUmVwZWF0Q29udGVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcblxuICAgICAgICBsZXQgZnVuY0JhY2tBcmdzID0gW107XG4gICAgICAgIGxldCBtb2RlbERhdGEgPSB0aGlzLl9zY29wZVt2YXJOYW1lXTtcblxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgIGVsZW1lbnREYXRhID0gZWxlbWVudHNbaV07XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBlbGVtZW50ICYmXG4gICAgICAgICAgICAgICAgZWxlbWVudC5kYXRhc2V0LmZpbHRlciAhPT0gZWxlbWVudERhdGEuZWxlbWVudC5kYXRhc2V0LmZpbHRlclxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlcGVhdERhdGEgPSB0aGlzLnJlc29sdmVRdWVyeS5jYWxsKFxuICAgICAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICAgICAgZWxlbWVudERhdGEuZWxlbWVudC5kYXRhc2V0W3RoaXMuUkVQRUFUX0FUVFJfTkFNRV1cbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmICghcmVwZWF0RGF0YS5kYXRhcyB8fCB2YXJOYW1lICE9PSByZXBlYXREYXRhLnZhck5hbWUpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudEhUTUwgPSBlbGVtZW50RGF0YS5lbGVtZW50LmlubmVySFRNTDtcblxuICAgICAgICAgICAgZWxlbWVudERhdGEuY2hpbGRzLmZvckVhY2goKGNoaWxkLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZWxlbWVudERhdGEucGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZChjaGlsZCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudERhdGEuY2hpbGRzLnNwbGljZSgxLCBlbGVtZW50RGF0YS5jaGlsZHMubGVuZ3RoKTtcblxuICAgICAgICAgICAgcmVwZWF0RGF0YS5kYXRhcy5mb3JFYWNoKGRhdGEgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBlbGVtZW50Q2xvbiA9IGVsZW1lbnREYXRhLmVsZW1lbnRDbG9uZS5jbG9uZU5vZGUoZmFsc2UpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudENsb24uaW5uZXJIVE1MID0gcmVuZGVyVGVtcGxhdGUoZWxlbWVudEhUTUwsIHtcbiAgICAgICAgICAgICAgICAgICAgW3JlcGVhdERhdGEudmFyc0l0ZXJhdGVdOiBkYXRhXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50c1JlcGVhdENvbnRlbnQuYXBwZW5kQ2hpbGQoZWxlbWVudENsb24pO1xuICAgICAgICAgICAgICAgIGVsZW1lbnREYXRhLmNoaWxkcy5wdXNoKGVsZW1lbnRDbG9uKTtcblxuICAgICAgICAgICAgICAgIGlmIChtb2RlbERhdGEuZnVuY0JhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgZnVuY0JhY2tBcmdzLnB1c2goW2RhdGEsIGVsZW1lbnRDbG9uXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGluc2VydEFmdGVyKGVsZW1lbnRzUmVwZWF0Q29udGVudCwgZWxlbWVudERhdGEuY2hpbGRzWzBdKTtcbiAgICAgICAgICAgIGVsZW1lbnRzUmVwZWF0Q29udGVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghIXZhck5hbWUgJiYgbW9kZWxEYXRhLmZ1bmNCYWNrKSB7XG4gICAgICAgICAgICBmdW5jQmFja0FyZ3MuZm9yRWFjaCgoYXJncykgPT4ge1xuICAgICAgICAgICAgICAgIG1vZGVsRGF0YS5mdW5jQmFjay5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWV0b2RvIGRlIGVudHJhZGEgbyBzYWxpZGEgZGVsIHNjb3BlXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAbWV0aG9kXG4gICAgICovXG4gICAgaW5pdChpc1JlZnJlc2gsIGZpbmRQYXJlbnRzKSB7XG4gICAgICAgIGxldCBzZWxlY3RvciA9ICdbZGF0YS0nICsgdGhpcy5SRVBFQVRfQVRUUl9OQU1FICsgJ10nO1xuXG4gICAgICAgIGxldCBlbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXG4gICAgICAgICAgICBzZWxlY3RvciArIChmaW5kUGFyZW50cyA/ICcnIDogJyAnICsgc2VsZWN0b3IpXG4gICAgICAgICk7XG4gICAgICAgIGxldCBlbGVtZW50ID0gbnVsbDtcbiAgICAgICAgbGV0IHJlcGVhdERhdGEgPSBudWxsO1xuICAgICAgICBsZXQgaTtcbiAgICAgICAgbGV0IGxlbjtcbiAgICAgICAgbGV0IGxlbkVsZW1lbnRzID0gMDtcbiAgICAgICAgbGV0IGVsZW1lbnRzUmVwZWF0Q29udGVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcblxuICAgICAgICBpZiAoIXRoaXMuX29yaWdpbmFsRWxlbWVudHMpIHtcbiAgICAgICAgICAgIHRoaXMuX29yaWdpbmFsRWxlbWVudHMgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IGVsZW1lbnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBlbGVtZW50ID0gZWxlbWVudHNbaV0uZWxlbWVudCB8fCBlbGVtZW50c1tpXTtcblxuICAgICAgICAgICAgcmVwZWF0RGF0YSA9IHRoaXMucmVzb2x2ZVF1ZXJ5LmNhbGwoXG4gICAgICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgICAgICBlbGVtZW50LmRhdGFzZXRbdGhpcy5SRVBFQVRfQVRUUl9OQU1FXVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWYgKCFyZXBlYXREYXRhLmRhdGFzKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCBlbGVtZW50SHRtbCA9IGVsZW1lbnQuaW5uZXJIVE1MO1xuXG4gICAgICAgICAgICBsZXQgZWxlbWVudENvcHkgPSBlbGVtZW50LmNsb25lTm9kZSh0cnVlKSxcbiAgICAgICAgICAgICAgICBjb21tZW50U3RhcnQgPSBkb2N1bWVudC5jcmVhdGVDb21tZW50KFxuICAgICAgICAgICAgICAgICAgICAnUmVwZWF0SFRNTDogc3RhcnQoICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5kYXRhc2V0W3RoaXMuUkVQRUFUX0FUVFJfTkFNRV0gK1xuICAgICAgICAgICAgICAgICAgICAgICAgJyApJ1xuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGVsZW1lbnRDb3B5LnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS0nICsgdGhpcy5SRVBFQVRfQVRUUl9OQU1FKTtcbiAgICAgICAgICAgIGVsZW1lbnRDb3B5LnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1maWx0ZXInKTtcblxuICAgICAgICAgICAgaWYgKCFpc1JlZnJlc2gpIHtcbiAgICAgICAgICAgICAgICAvL0FsbWFjZW5hciBjYWRhIGVsZW1lbnRvIG9yaWdpbmFsIGVuIHVuYSBhcnJlZ2xvXG4gICAgICAgICAgICAgICAgdGhpcy5fb3JpZ2luYWxFbGVtZW50cy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudC5jbG9uZU5vZGUodHJ1ZSksXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRDbG9uZTogZWxlbWVudENvcHksXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudEVsZW1lbnQ6IGVsZW1lbnQucGFyZW50RWxlbWVudCxcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRzOiBbY29tbWVudFN0YXJ0XVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgbGVuRWxlbWVudHMgPSB0aGlzLl9vcmlnaW5hbEVsZW1lbnRzLmxlbmd0aDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudHNSZXBlYXRDb250ZW50LmFwcGVuZENoaWxkKGNvbW1lbnRTdGFydCk7XG5cbiAgICAgICAgICAgIC8vQ29tZW50YXJpbyBkZWxpbWl0YWRvciBkZSBpbmljaW9cbiAgICAgICAgICAgIHJlcGVhdERhdGEuZGF0YXMuZm9yRWFjaChkYXRhID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgZWxlbWVudENsb25lZCA9IGVsZW1lbnRDb3B5LmNsb25lTm9kZShmYWxzZSk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50Q2xvbmVkLmlubmVySFRNTCA9IHJlbmRlclRlbXBsYXRlKGVsZW1lbnRIdG1sLCB7XG4gICAgICAgICAgICAgICAgICAgIFtyZXBlYXREYXRhLnZhcnNJdGVyYXRlXTogZGF0YVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudHNSZXBlYXRDb250ZW50LmFwcGVuZENoaWxkKGVsZW1lbnRDbG9uZWQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFpc1JlZnJlc2gpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb3JpZ2luYWxFbGVtZW50c1tsZW5FbGVtZW50cyAtIDFdLmNoaWxkcy5wdXNoKFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudENsb25lZFxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50LnBhcmVudEVsZW1lbnQucmVwbGFjZUNoaWxkKGVsZW1lbnRzUmVwZWF0Q29udGVudCwgZWxlbWVudCk7XG4gICAgICAgICAgICBlbGVtZW50c1JlcGVhdENvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikubGVuZ3RoID4gMCAmJiAhZmluZFBhcmVudHMpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmluaXQoaXNSZWZyZXNoLCB0cnVlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc3VlbHZlIGxhIGNhZGVuYSBkZSB0ZXh0byBkZWwgcmVwZWF0IGEgZG9zIHByb3BpZWRhZGVzXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAbWV0aG9kXG4gICAgICovXG4gICAgcmVzb2x2ZVF1ZXJ5KHF1ZXJ5KSB7XG4gICAgICAgIHF1ZXJ5ID0gcXVlcnkuc3BsaXQocGF0dGVybnMuc3BsaXRRdWVyeSk7XG5cbiAgICAgICAgaWYgKHF1ZXJ5WzBdLnRyaW0oKSA9PT0gJycgJiYgIXF1ZXJ5WzFdKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHZhcnNJdGVyYXRlOiBudWxsLFxuICAgICAgICAgICAgICAgIGRhdGFzOiBudWxsLFxuICAgICAgICAgICAgICAgIHZhck5hbWU6IG51bGxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdmFyc0l0ZXJhdGU6IHF1ZXJ5WzBdLnNwbGl0KHBhdHRlcm5zLnNwbGl0UXVlcnlWYXJzKSxcbiAgICAgICAgICAgIGRhdGFzOiB0aGlzLnBhcnNlRGF0YS5jYWxsKHRoaXMsIHF1ZXJ5WzFdLnRyaW0oKSksXG4gICAgICAgICAgICB2YXJOYW1lOiBxdWVyeVsxXS50cmltKClcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb2RpZmljYSBsb3MgZGF0b3MgZGUgZW50cmFkYSBkZXBlbmRpZW5kbyBkZWwgdGlwbywgYXJyYXkgbyBzdHJpbmdcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBtZXRob2RcbiAgICAgKi9cbiAgICBwYXJzZURhdGEoc3RyRGF0YSkge1xuICAgICAgICBpZiAodGhpcy5fc2NvcGVbc3RyRGF0YV0pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFwcGx5RmlsdGVyKHN0ckRhdGEpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgcGF0dGVybnMuaXNBcnJheVNpbnRheC5pbmkudGVzdChzdHJEYXRhKSAmJlxuICAgICAgICAgICAgcGF0dGVybnMuaXNBcnJheVNpbnRheC5lbmQudGVzdChzdHJEYXRhKVxuICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiBldmFsKHN0ckRhdGEpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuXG4vKipcbiAqIEluamVjdG9yIGRlIGRhdG9zIGRlbnRybyBkZSB1biB0ZW1wbGF0ZShjYWRlbmEgZGUgdGV4dG8pXG4gKiBAcHJpdmF0ZVxuICogQG1ldGhvZFxuICovXG5mdW5jdGlvbiByZW5kZXJUZW1wbGF0ZSh0ZW1wbGF0ZSwgZGF0YSkge1xuICAgIHJldHVybiB0ZW1wbGF0ZVxuICAgICAgICAucmVwbGFjZShwYXR0ZXJucy5rZXlUeXBlQXJyYXksICcuJDEnKVxuICAgICAgICAucmVwbGFjZShwYXR0ZXJucy5maW5kVGVtcGxhdGVWYXJzLCAoZmluZCwga2V5KSA9PiB7XG4gICAgICAgICAgICBsZXQgcGFydHNLZXkgPSBrZXkuc3BsaXQoJy4nKTtcbiAgICAgICAgICAgIGxldCBmaW5kZXIgPSBkYXRhW3BhcnRzS2V5WzBdXTtcbiAgICAgICAgICAgIGxldCBpZHg7XG5cbiAgICAgICAgICAgIGZvciAoaWR4ID0gMTsgaWR4IDwgcGFydHNLZXkubGVuZ3RoOyBpZHgrKykge1xuICAgICAgICAgICAgICAgIGZpbmRlciA9IGZpbmRlcltwYXJ0c0tleVtpZHhdXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGZpbmRlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaW5kZXI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBmaW5kO1xuICAgICAgICB9KTtcbn1cblxuLyoqXG4gKiBVdGlsc1xuICovXG5mdW5jdGlvbiBpbnNlcnRBZnRlcihpbnNlcnRFbGVtZW50LCBlbGVtZW50KSB7XG4gICAgaWYgKGVsZW1lbnQubmV4dFNpYmxpbmcpIHtcbiAgICAgICAgZWxlbWVudC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShpbnNlcnRFbGVtZW50LCBlbGVtZW50Lm5leHRTaWJsaW5nKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGVsZW1lbnQucGFyZW50Tm9kZS5hcHBlbmRDaGlsZChpbnNlcnRFbGVtZW50KTtcbn1cblxuZnVuY3Rpb24gaXNPZlR5cGUoZGF0YSwgY29tcGFyZSkge1xuICAgIHJldHVybiAoXG4gICAgICAgIHt9LnRvU3RyaW5nXG4gICAgICAgICAgICAuY2FsbChkYXRhKVxuICAgICAgICAgICAgLm1hdGNoKC9cXHMoLispXFxdJC8pWzFdXG4gICAgICAgICAgICAudG9Mb3dlckNhc2UoKSA9PT0gY29tcGFyZVxuICAgICk7XG59XG4iXSwic291cmNlUm9vdCI6IiJ9