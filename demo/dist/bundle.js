!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(e,t,r){"use strict";r.d(t,"a",function(){return n});var n={keyTypeArray:/\[\s*(\d+)\s*\]+/g,params:/\{\s*(\d+)\s*\}+/g,splitQuery:/\s+in\s+/,findTemplateVars:/\{\{\s*([\[\]\$\.\_0-9a-zA-Z]+)\s*\}\}/g,splitQueryVars:/\s*,\s*/,isArraySintax:{ini:/(?=^\s*\[)/,end:/(?=\]\s*$)/},filters:{like:/\s+like\s+/,as:/\s+as\s+/},hasSelectorCss:/^(#|\.)\S/}},function(e,t,r){"use strict";r.d(t,"a",function(){return i});var n=r(0),i=function(){function e(){}return e.renderTemplate=function(e,t){return e.replace(n.a.keyTypeArray,".$1").replace(n.a.findTemplateVars,function(e,r){for(var n=r.split("."),i=t[n[0]],a=1;a<n.length;a++)i=i[n[a]];return i||e})},e.insertAfter=function(e,t){t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e)},e.isOfType=function(e,t){return{}.toString.call(e).match(/\s(.+)\]$/)[1].toLowerCase()===t},e}()},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return RepeatHtml});var _patterns__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_filter__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4),_helpers__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),_scope__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(3),RepeatHtml=function(){function RepeatHtml(e){void 0===e&&(e={}),this.repeatAttributeName=e.attrName||"repeat",this._scope=new _scope__WEBPACK_IMPORTED_MODULE_3__.a(e.scope),this.originalElements=null,this.filter=new _filter__WEBPACK_IMPORTED_MODULE_1__.a(this._scope,this.repeatAttributeName,this.refresh.bind(this)),this.selector="[data-"+this.repeatAttributeName+"]",(e.compile||void 0===e.compile)&&this.init(!1,!1)}return RepeatHtml.prototype.scope=function(e,t,r){return void 0===t?this._scope.get(e):(this._scope.add(e,t,r),this.refresh(e),this._scope.get(e).funcBackAfter.call(this,t),this)},RepeatHtml.prototype.refresh=function(e,t){return document.querySelectorAll(this.selector).length>0&&this.init(!1,!1),this.reRender(e,t),this},RepeatHtml.prototype.reRender=function(e,t){for(var r,n=this,i=this.originalElements,a=null,s=document.createDocumentFragment(),o=[],c=this._scope.get(e),l=function(n){if(r=i[n],t&&t.dataset.filter!==r.element.dataset.filter)return"continue";if(!(a=u.resolveQuery(r.element.dataset[u.repeatAttributeName])).datas||e!==a.varName)return"continue";var l=r.element.innerHTML;r.childs.forEach(function(e,t){0!==t&&r.parentElement.removeChild(e)}),r.childs.splice(1,r.childs.length),a.datas.forEach(function(e){var t,n=r.elementClone.cloneNode(!1);n.innerHTML=_helpers__WEBPACK_IMPORTED_MODULE_2__.a.renderTemplate(l,((t={})[a.varsIterate]=e,t)),s.appendChild(n),r.childs.push(n),c.funcBack&&o.push([e,n])}),_helpers__WEBPACK_IMPORTED_MODULE_2__.a.insertAfter(s,r.childs[0]),s=document.createDocumentFragment()},u=this,p=0;p<i.length;p++)l(p);e&&c.funcBack&&o.forEach(function(e){c.funcBack.apply(n,e)})},RepeatHtml.prototype.init=function(e,t){var r=this,n=document.querySelectorAll(this.selector+(t?"":" "+this.selector)),i=null,a=null,s=0,o=document.createDocumentFragment();this.originalElements||(this.originalElements=[]);for(var c=function(t){if(i=n[t].element||n[t],!(a=l.resolveQuery(i.dataset[l.repeatAttributeName])).datas)return"continue";var c=i.innerHTML,u=i.cloneNode(!0),p=document.createComment("RepeatHTML: start( "+i.dataset[l.repeatAttributeName]+" )");u.removeAttribute("data-"+l.repeatAttributeName),u.removeAttribute("data-filter"),e||(l.originalElements.push({element:i.cloneNode(!0),elementClone:u,parentElement:i.parentElement,childs:[p]}),s=l.originalElements.length),o.appendChild(p),a.datas.forEach(function(t){var n,i=u.cloneNode(!1);i.innerHTML=_helpers__WEBPACK_IMPORTED_MODULE_2__.a.renderTemplate(c,((n={})[a.varsIterate]=t,n)),o.appendChild(i),e||r.originalElements[s-1].childs.push(i)}),i.parentElement.replaceChild(o,i),o=document.createDocumentFragment()},l=this,u=0;u<n.length;u++)c(u);if(document.querySelectorAll(this.selector).length>0&&!t)return this.init(e,!0)},RepeatHtml.prototype.resolveQuery=function(e){return""!==(e=e.split(_patterns__WEBPACK_IMPORTED_MODULE_0__.a.splitQuery))[0].trim()||e[1]?{varsIterate:e[0].split(_patterns__WEBPACK_IMPORTED_MODULE_0__.a.splitQueryVars),datas:this.parseData.call(this,e[1].trim()),varName:e[1].trim()}:{varsIterate:null,datas:null,varName:null}},RepeatHtml.prototype.parseData=function(strData){return this._scope.get(strData)?this.filter.apply(strData):_patterns__WEBPACK_IMPORTED_MODULE_0__.a.isArraySintax.ini.test(strData)&&_patterns__WEBPACK_IMPORTED_MODULE_0__.a.isArraySintax.end.test(strData)?eval(strData):null},RepeatHtml}()},function(e,t,r){"use strict";r.d(t,"a",function(){return i});var n=r(1),i=function(){function e(e){this._scope=e||{}}return e.prototype.add=function(e,t,r){return this._scope[e]=this._scope[e]||{},this._scope[e].data=t,this._scope[e].originalData=t,this._scope[e].funcBackAfter=function(){},this._scope[e].funcBack=function(){},"function"==typeof r?this._scope[e].funcBackAfter=r:n.a.isOfType(r,"array")?(this._scope[e].funcBackAfter=r[0],this._scope[e].funcBack=r[1]):"object"==typeof r&&(this._scope[e].funcBackAfter=r.after,this._scope[e].funcBack=r.funcBack),this},e.prototype.get=function(e){return this._scope[e]},e}()},function(e,t,r){"use strict";r.d(t,"a",function(){return i});var n=r(0),i=function(){function e(e,t,r){this.scope=e,this.repeatAttributeName=t,this.callback=r,this.filters={},this.findFilters()}return e.prototype.apply=function(e){return e&&this.filters[e]?this.scope.get(e).data.filter(this.filters[e]):this.scope.get(e).data},e.prototype.filter=function(e,t,r){var i=this;if(t=t.trim(),this.validate(e,t))return!1;var a=t.split(n.a.filters.as),s=a[0],o=a[1];o||(o=s,s=null);var c=document.getElementById(o.replace(/#|^%|%$/g,""));if(c){var l=/^%/g.test(o)?"^":"",u=/%$/g.test(o)?"$":"";return t=c.value,c.addEventListener("keyup",function(t){var n=t.target.value;i.scope.get(e).data=i.scope.get(e).originalData.filter(function(e){var t=new RegExp(l+n+u,"gi");if(s)return t.test(e[s]);for(var r in e)if(t.test(e[r]))return!0}),i.callback(e,r)}),this}},e.prototype.validate=function(e,t){return void 0!==e&&(!(!n.a.filters.as.test(t)&&!n.a.hasSelectorCss.test(t.replace(/^%|%$/g,"")))&&void 0)},e.prototype.findFilters=function(){for(var e,t,r=this,i=document.querySelectorAll("[data-filter]"),a=0;e=i[a];a++)t=e.dataset[this.repeatAttributeName].split(n.a.splitQuery),e.dataset.filter.split(n.a.splitQueryVars).forEach(function(n){r.filter(t[1],n,e)})},e}()},function(e,t,r){"use strict";r.r(t);var n=r(2);r.d(t,"RepeatHtml",function(){return n.a})}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovLy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly8vLi9zcmMvcGF0dGVybnMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2hlbHBlcnMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3JlcGVhdC1odG1sLnRzIiwid2VicGFjazovLy8uL3NyYy9zY29wZS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZmlsdGVyLnRzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsImEiLCJpIiwid2luZG93IiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsInZhbHVlIiwibiIsIl9fZXNNb2R1bGUiLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJwYXR0ZXJucyIsImtleVR5cGVBcnJheSIsInBhcmFtcyIsInNwbGl0UXVlcnkiLCJmaW5kVGVtcGxhdGVWYXJzIiwic3BsaXRRdWVyeVZhcnMiLCJpc0FycmF5U2ludGF4IiwiaW5pIiwiZW5kIiwiZmlsdGVycyIsImxpa2UiLCJhcyIsImhhc1NlbGVjdG9yQ3NzIiwiSGVscGVycyIsInJlbmRlclRlbXBsYXRlIiwidGVtcGxhdGUiLCJkYXRhIiwicmVwbGFjZSIsIl9wYXR0ZXJuc19fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fIiwiZmluZCIsImtleSIsInBhcnRzS2V5Iiwic3BsaXQiLCJmaW5kZXIiLCJpZHgiLCJsZW5ndGgiLCJpbnNlcnRBZnRlciIsImluc2VydEVsZW1lbnQiLCJlbGVtZW50IiwibmV4dFNpYmxpbmciLCJwYXJlbnROb2RlIiwiaW5zZXJ0QmVmb3JlIiwiYXBwZW5kQ2hpbGQiLCJpc09mVHlwZSIsImNvbXBhcmUiLCJ0b1N0cmluZyIsIm1hdGNoIiwidG9Mb3dlckNhc2UiLCJSZXBlYXRIdG1sIiwiY29uZmlnIiwidGhpcyIsInJlcGVhdEF0dHJpYnV0ZU5hbWUiLCJhdHRyTmFtZSIsIl9zY29wZSIsIl9zY29wZV9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfM19fIiwic2NvcGUiLCJvcmlnaW5hbEVsZW1lbnRzIiwiZmlsdGVyIiwiX2ZpbHRlcl9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fIiwicmVmcmVzaCIsImJpbmQiLCJzZWxlY3RvciIsImNvbXBpbGUiLCJ1bmRlZmluZWQiLCJpbml0IiwidmFyTmFtZSIsImZ1bmNCYWNrcyIsImFkZCIsImZ1bmNCYWNrQWZ0ZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJyZVJlbmRlciIsImVsZW1lbnREYXRhIiwiX3RoaXMiLCJlbGVtZW50cyIsInJlcGVhdERhdGEiLCJlbGVtZW50c1JlcGVhdENvbnRlbnQiLCJjcmVhdGVEb2N1bWVudEZyYWdtZW50IiwiZnVuY0JhY2tBcmdzIiwibW9kZWxEYXRhIiwiZGF0YXNldCIsInRoaXNfMSIsInJlc29sdmVRdWVyeSIsImRhdGFzIiwiZWxlbWVudEhUTUwiLCJpbm5lckhUTUwiLCJjaGlsZHMiLCJmb3JFYWNoIiwiY2hpbGQiLCJpbmRleCIsInBhcmVudEVsZW1lbnQiLCJyZW1vdmVDaGlsZCIsInNwbGljZSIsImVsZW1lbnRDbG9uIiwiZWxlbWVudENsb25lIiwiY2xvbmVOb2RlIiwiX2hlbHBlcnNfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzJfXyIsIl9hIiwidmFyc0l0ZXJhdGUiLCJwdXNoIiwiZnVuY0JhY2siLCJhcmdzIiwiYXBwbHkiLCJpc1JlZnJlc2giLCJmaW5kUGFyZW50cyIsImxlbkVsZW1lbnRzIiwidGhpc18yIiwiZWxlbWVudEh0bWwiLCJlbGVtZW50Q29weSIsImNvbW1lbnRTdGFydCIsImNyZWF0ZUNvbW1lbnQiLCJyZW1vdmVBdHRyaWJ1dGUiLCJlbGVtZW50Q2xvbmVkIiwicmVwbGFjZUNoaWxkIiwicXVlcnkiLCJ0cmltIiwicGFyc2VEYXRhIiwic3RyRGF0YSIsInRlc3QiLCJldmFsIiwiU2NvcGUiLCJvcmlnaW5hbERhdGEiLCJfaGVscGVyc19fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fIiwiYWZ0ZXIiLCJ2YXJpYWJsZU5hbWUiLCJGaWx0ZXIiLCJjYWxsYmFjayIsImZpbmRGaWx0ZXJzIiwiZmlsdGVyVmFsdWUiLCJ2YWxpZGF0ZSIsIl9maWx0ZXIiLCJwcm9wIiwiZWxlbSIsImdldEVsZW1lbnRCeUlkIiwiaGFzUGVyY2VudEluaXQiLCJoYXNQZXJjZW50RW5kIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwidGFyZ2V0IiwicGF0dGVybiIsIlJlZ0V4cCIsIl9wcm9wIiwicXVlcnlSZXBlYXQiLCJxdWVyeUZpbHRlcnMiXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBQ0Esb0JBQUFDLFNBQUEsaUJBQUFDLE9BQ0FBLE9BQUFELFFBQUFELFNBQ0Esc0JBQUFHLGVBQUFDLElBQ0FELFVBQUFILE9BQ0EsQ0FDQSxJQUFBSyxFQUFBTCxJQUNBLFFBQUFNLEtBQUFELEdBQUEsaUJBQUFKLGdCQUFBRixHQUFBTyxHQUFBRCxFQUFBQyxJQVBBLENBU0NDLE9BQUEsV0FDRCxtQkNUQSxJQUFBQyxLQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBVCxRQUdBLElBQUFDLEVBQUFNLEVBQUFFLElBQ0FKLEVBQUFJLEVBQ0FDLEdBQUEsRUFDQVYsWUFVQSxPQU5BVyxFQUFBRixHQUFBRyxLQUFBWCxFQUFBRCxRQUFBQyxJQUFBRCxRQUFBUSxHQUdBUCxFQUFBUyxHQUFBLEVBR0FULEVBQUFELFFBMkNBLE9BdENBUSxFQUFBSyxFQUFBRixFQUdBSCxFQUFBTSxFQUFBUCxFQUdBQyxFQUFBTyxFQUFBLFNBQUFmLEVBQUFnQixFQUFBQyxHQUNBVCxFQUFBVSxFQUFBbEIsRUFBQWdCLElBQ0FHLE9BQUFDLGVBQUFwQixFQUFBZ0IsR0FDQUssY0FBQSxFQUNBQyxZQUFBLEVBQ0FDLElBQUFOLEtBTUFULEVBQUFnQixFQUFBLFNBQUF4QixHQUNBbUIsT0FBQUMsZUFBQXBCLEVBQUEsY0FBaUR5QixPQUFBLEtBSWpEakIsRUFBQWtCLEVBQUEsU0FBQXpCLEdBQ0EsSUFBQWdCLEVBQUFoQixLQUFBMEIsV0FDQSxXQUEyQixPQUFBMUIsRUFBQSxTQUMzQixXQUFpQyxPQUFBQSxHQUVqQyxPQURBTyxFQUFBTyxFQUFBRSxFQUFBLElBQUFBLEdBQ0FBLEdBSUFULEVBQUFVLEVBQUEsU0FBQVUsRUFBQUMsR0FBc0QsT0FBQVYsT0FBQVcsVUFBQUMsZUFBQW5CLEtBQUFnQixFQUFBQyxJQUd0RHJCLEVBQUF3QixFQUFBLEdBSUF4QixJQUFBeUIsRUFBQSxrRUNuRU8sSUFBTUMsR0FDVEMsYUFBYyxvQkFDZEMsT0FBUSxvQkFDUkMsV0FBWSxXQUNaQyxpQkFBa0IsMENBQ2xCQyxlQUFnQixVQUNoQkMsZUFDSUMsSUFBSyxhQUNMQyxJQUFLLGNBRVRDLFNBQ0lDLEtBQU0sYUFDTkMsR0FBSSxZQUVSQyxlQUFnQixzRkNacEJDLEVBQUEsb0JBQUFBLEtBMkNBLE9BckNXQSxFQUFBQyxlQUFQLFNBQXNCQyxFQUFVQyxHQUM1QixPQUFPRCxFQUNGRSxRQUFRQyxFQUFBLEVBQVNqQixhQUFjLE9BQy9CZ0IsUUFBUUMsRUFBQSxFQUFTZCxpQkFBa0IsU0FBQ2UsRUFBTUMsR0FJdkMsSUFIQSxJQUFJQyxFQUFXRCxFQUFJRSxNQUFNLEtBQ3JCQyxFQUFTUCxFQUFLSyxFQUFTLElBRWxCRyxFQUFNLEVBQUdBLEVBQU1ILEVBQVNJLE9BQVFELElBQ3JDRCxFQUFTQSxFQUFPRixFQUFTRyxJQUc3QixPQUFJRCxHQUlHSixLQUlaTixFQUFBYSxZQUFQLFNBQW1CQyxFQUFlQyxHQUMxQkEsRUFBUUMsWUFDUkQsRUFBUUUsV0FBV0MsYUFBYUosRUFBZUMsRUFBUUMsYUFLM0RELEVBQVFFLFdBQVdFLFlBQVlMLElBRzVCZCxFQUFBb0IsU0FBUCxTQUFnQmpCLEVBQU1rQixHQUNsQixTQUNPQyxTQUNFekQsS0FBS3NDLEdBQ0xvQixNQUFNLGFBQWEsR0FDbkJDLGdCQUFrQkgsR0FHbkNyQixFQTNDQSw2WUNHQXlCLFdBQUEsV0FPSSxTQUFBQSxXQUFZQyxRQUFBLElBQUFBLFVBQ1JDLEtBQUtDLG9CQUFzQkYsRUFBT0csVUFBWSxTQUM5Q0YsS0FBS0csT0FBUyxJQUFJQyxvQ0FBQSxFQUFNTCxFQUFPTSxPQUMvQkwsS0FBS00saUJBQW1CLEtBRXhCTixLQUFLTyxPQUFTLElBQUlDLHFDQUFBLEVBQ2RSLEtBQUtHLE9BQ0xILEtBQUtDLG9CQUNMRCxLQUFLUyxRQUFRQyxLQUFLVixPQUd0QkEsS0FBS1csU0FBVyxTQUFXWCxLQUFLQyxvQkFBc0IsS0FFbERGLEVBQU9hLGNBQThCQyxJQUFuQmQsRUFBT2EsVUFDekJaLEtBQUtjLE1BQUssR0FBTyxHQWdQN0IsT0FuT0loQixXQUFBMUMsVUFBQWlELE1BQUEsU0FBTVUsRUFBaUJ2QyxFQUFNd0MsR0FDekIsWUFBYUgsSUFBVHJDLEVBQ093QixLQUFLRyxPQUFPdEQsSUFBSWtFLElBRzNCZixLQUFLRyxPQUFPYyxJQUFJRixFQUFTdkMsRUFBTXdDLEdBQy9CaEIsS0FBS1MsUUFBUU0sR0FDYmYsS0FBS0csT0FBT3RELElBQUlrRSxHQUFTRyxjQUFjaEYsS0FBSzhELEtBQU14QixHQUUzQ3dCLE9BUVhGLFdBQUExQyxVQUFBcUQsUUFBQSxTQUFRTSxFQUFTM0IsR0FXYixPQVRJK0IsU0FBU0MsaUJBQWlCcEIsS0FBS1csVUFBVTFCLE9BQVMsR0FHbERlLEtBQUtjLE1BQUssR0FBTyxHQUdyQmQsS0FBS3FCLFNBQVNOLEVBQVMzQixHQUdoQlksTUFRWEYsV0FBQTFDLFVBQUFpRSxTQUFBLFNBQVNOLEVBQVMzQixHQVNkLElBVEosSUFHUWtDLEVBSFJDLEVBQUF2QixLQUNRd0IsRUFBV3hCLEtBQUtNLGlCQUNoQm1CLEVBQWEsS0FFYkMsRUFBd0JQLFNBQVNRLHlCQUVqQ0MsS0FDQUMsRUFBWTdCLEtBQUtHLE9BQU90RCxJQUFJa0UsY0FFdkJwRixHQUdMLEdBRkEyRixFQUFjRSxFQUFTN0YsR0FHbkJ5RCxHQUNBQSxFQUFRMEMsUUFBUXZCLFNBQVdlLEVBQVlsQyxRQUFRMEMsUUFBUXZCLHdCQVMzRCxLQUpBa0IsRUFBYU0sRUFBS0MsYUFDZFYsRUFBWWxDLFFBQVEwQyxRQUFRQyxFQUFLOUIsdUJBR3JCZ0MsT0FBU2xCLElBQVlVLEVBQVdWLHlCQUloRCxJQUFJbUIsRUFBY1osRUFBWWxDLFFBQVErQyxVQUV0Q2IsRUFBWWMsT0FBT0MsUUFBUSxTQUFDQyxFQUFPQyxHQUNqQixJQUFWQSxHQUlKakIsRUFBWWtCLGNBQWNDLFlBQVlILEtBRzFDaEIsRUFBWWMsT0FBT00sT0FBTyxFQUFHcEIsRUFBWWMsT0FBT25ELFFBRWhEd0MsRUFBV1EsTUFBTUksUUFBUSxTQUFBN0QsR0FDckIsTUFBSW1FLEVBQWNyQixFQUFZc0IsYUFBYUMsV0FBVSxHQUVyREYsRUFBWVIsVUFBWVcsc0NBQUEsRUFBUXhFLGVBQWU0RCxJQUFXYSxNQUNyRHRCLEVBQVd1QixhQUFjeEUsTUFHOUJrRCxFQUFzQmxDLFlBQVltRCxHQUNsQ3JCLEVBQVljLE9BQU9hLEtBQUtOLEdBRXBCZCxFQUFVcUIsVUFDVnRCLEVBQWFxQixNQUFNekUsRUFBTW1FLE1BSWpDRyxzQ0FBQSxFQUFRNUQsWUFBWXdDLEVBQXVCSixFQUFZYyxPQUFPLElBQzlEVixFQUF3QlAsU0FBU1EsaUNBOUM1QmhHLEVBQUksRUFBR0EsRUFBSTZGLEVBQVN2QyxPQUFRdEQsTUFBNUJBLEdBaURIb0YsR0FBV2MsRUFBVXFCLFVBQ3ZCdEIsRUFBYVMsUUFBUSxTQUFBYyxHQUNqQnRCLEVBQVVxQixTQUFTRSxNQUFNN0IsRUFBTTRCLE1BVTNDckQsV0FBQTFDLFVBQUEwRCxLQUFBLFNBQUt1QyxFQUFXQyxHQUFoQixJQUFBL0IsRUFBQXZCLEtBQ1F3QixFQUFnQkwsU0FBU0MsaUJBQ3pCcEIsS0FBS1csVUFBWTJDLEVBQWMsR0FBSyxJQUFNdEQsS0FBS1csV0FFL0N2QixFQUFVLEtBQ1ZxQyxFQUFhLEtBQ2I4QixFQUFjLEVBQ2Q3QixFQUF3QlAsU0FBU1EseUJBRWhDM0IsS0FBS00sbUJBQ05OLEtBQUtNLHFCQUdULG1CQUFTM0UsR0FPTCxHQU5BeUQsRUFBVW9DLEVBQVM3RixHQUFHeUQsU0FBV29DLEVBQVM3RixLQUUxQzhGLEVBQWErQixFQUFLeEIsYUFDZDVDLEVBQVEwQyxRQUFRMEIsRUFBS3ZELHVCQUdUZ0MsdUJBSWhCLElBQUl3QixFQUFjckUsRUFBUStDLFVBRXRCdUIsRUFBY3RFLEVBQVF5RCxXQUFVLEdBQ2hDYyxFQUFleEMsU0FBU3lDLGNBQ3BCLHNCQUNJeEUsRUFBUTBDLFFBQVEwQixFQUFLdkQscUJBQ3JCLE1BR1p5RCxFQUFZRyxnQkFBZ0IsUUFBVUwsRUFBS3ZELHFCQUMzQ3lELEVBQVlHLGdCQUFnQixlQUV2QlIsSUFFREcsRUFBS2xELGlCQUFpQjJDLE1BQ2xCN0QsUUFBU0EsRUFBUXlELFdBQVUsR0FDM0JELGFBQWNjLEVBQ2RsQixjQUFlcEQsRUFBUW9ELGNBQ3ZCSixRQUFTdUIsS0FHYkosRUFBY0MsRUFBS2xELGlCQUFpQnJCLFFBR3hDeUMsRUFBc0JsQyxZQUFZbUUsR0FHbENsQyxFQUFXUSxNQUFNSSxRQUFRLFNBQUE3RCxHQUNyQixNQUFJc0YsRUFBZ0JKLEVBQVliLFdBQVUsR0FFMUNpQixFQUFjM0IsVUFBWVcsc0NBQUEsRUFBUXhFLGVBQWVtRixJQUFXVixNQUN2RHRCLEVBQVd1QixhQUFjeEUsTUFHOUJrRCxFQUFzQmxDLFlBQVlzRSxHQUU3QlQsR0FDRDlCLEVBQUtqQixpQkFBaUJpRCxFQUFjLEdBQUduQixPQUFPYSxLQUMxQ2EsS0FLWjFFLEVBQVFvRCxjQUFjdUIsYUFBYXJDLEVBQXVCdEMsR0FDMURzQyxFQUF3QlAsU0FBU1EsaUNBdkQ1QmhHLEVBQUksRUFBR0EsRUFBSTZGLEVBQVN2QyxPQUFRdEQsTUFBNUJBLEdBMERULEdBQ0l3RixTQUFTQyxpQkFBaUJwQixLQUFLVyxVQUFVMUIsT0FBUyxJQUNqRHFFLEVBRUQsT0FBT3RELEtBQUtjLEtBQUt1QyxHQUFXLElBU3BDdkQsV0FBQTFDLFVBQUE0RSxhQUFBLFNBQWFnQyxHQUdULE1BQXdCLE1BRnhCQSxFQUFRQSxFQUFNbEYsTUFBTUosdUNBQUEsRUFBU2YsYUFFbkIsR0FBR3NHLFFBQWtCRCxFQUFNLElBU2pDaEIsWUFBYWdCLEVBQU0sR0FBR2xGLE1BQU1KLHVDQUFBLEVBQVNiLGdCQUNyQ29FLE1BQU9qQyxLQUFLa0UsVUFBVWhJLEtBQUs4RCxLQUFNZ0UsRUFBTSxHQUFHQyxRQUMxQ2xELFFBQVNpRCxFQUFNLEdBQUdDLFNBVGRqQixZQUFhLEtBQ2JmLE1BQU8sS0FDUGxCLFFBQVMsT0FnQnJCakIsV0FBQTFDLFVBQUE4RyxVQUFBLFNBQVVDLFNBQ04sT0FBSW5FLEtBQUtHLE9BQU90RCxJQUFJc0gsU0FDVG5FLEtBQUtPLE9BQU82QyxNQUFNZSxTQUl6QnpGLHVDQUFBLEVBQVNaLGNBQWNDLElBQUlxRyxLQUFLRCxVQUNoQ3pGLHVDQUFBLEVBQVNaLGNBQWNFLElBQUlvRyxLQUFLRCxTQUV6QkUsS0FBS0YsU0FHVCxNQUVmckUsV0FyUUEsNEVDSEF3RSxFQUFBLFdBUUksU0FBQUEsRUFBWWpFLEdBQ1JMLEtBQUtHLE9BQVNFLE1BbUN0QixPQXZCSWlFLEVBQUFsSCxVQUFBNkQsSUFBQSxTQUFJRixFQUFpQnZDLEVBQU13QyxHQWlCdkIsT0FoQkFoQixLQUFLRyxPQUFPWSxHQUFXZixLQUFLRyxPQUFPWSxPQUNuQ2YsS0FBS0csT0FBT1ksR0FBU3ZDLEtBQU9BLEVBQzVCd0IsS0FBS0csT0FBT1ksR0FBU3dELGFBQWUvRixFQUNwQ3dCLEtBQUtHLE9BQU9ZLEdBQVNHLGNBQWdCLGFBQ3JDbEIsS0FBS0csT0FBT1ksR0FBU21DLFNBQVcsYUFFUCxtQkFBZGxDLEVBQ1BoQixLQUFLRyxPQUFPWSxHQUFTRyxjQUFnQkYsRUFDOUJ3RCxFQUFBLEVBQVEvRSxTQUFTdUIsRUFBVyxVQUNuQ2hCLEtBQUtHLE9BQU9ZLEdBQVNHLGNBQWdCRixFQUFVLEdBQy9DaEIsS0FBS0csT0FBT1ksR0FBU21DLFNBQVdsQyxFQUFVLElBQ2QsaUJBQWRBLElBQ2RoQixLQUFLRyxPQUFPWSxHQUFTRyxjQUFnQkYsRUFBVXlELE1BQy9DekUsS0FBS0csT0FBT1ksR0FBU21DLFNBQVdsQyxFQUFVa0MsVUFHdkNsRCxNQUdYc0UsRUFBQWxILFVBQUFQLElBQUEsU0FBSTZILEdBQ0EsT0FBTzFFLEtBQUtHLE9BQU91RSxJQUUzQkosRUE1Q0EsNEVDQ0FLLEVBQUEsV0FNSSxTQUFBQSxFQUFZdEUsRUFBY0osRUFBNkIyRSxHQUNuRDVFLEtBQUtLLE1BQVFBLEVBQ2JMLEtBQUtDLG9CQUFzQkEsRUFDM0JELEtBQUs0RSxTQUFXQSxFQUNoQjVFLEtBQUsvQixXQUVMK0IsS0FBSzZFLGNBcUhiLE9BN0dJRixFQUFBdkgsVUFBQWdHLE1BQUEsU0FBTXJDLEdBQ0YsT0FBS0EsR0FBWWYsS0FBSy9CLFFBQVE4QyxHQUl2QmYsS0FBS0ssTUFBTXhELElBQUlrRSxHQUFTdkMsS0FBSytCLE9BQU9QLEtBQUsvQixRQUFROEMsSUFIN0NmLEtBQUtLLE1BQU14RCxJQUFJa0UsR0FBU3ZDLE1BWXZDbUcsRUFBQXZILFVBQUFtRCxPQUFBLFNBQU9tRSxFQUFzQkksRUFBcUIxRixHQUFsRCxJQUFBbUMsRUFBQXZCLEtBR0ksR0FGQThFLEVBQWNBLEVBQVliLE9BRXRCakUsS0FBSytFLFNBQVNMLEVBQWNJLEdBQzVCLE9BQU8sRUFHWCxJQUFJRSxFQUFVRixFQUFZaEcsTUFBTUosRUFBQSxFQUFTVCxRQUFRRSxJQUU3QzhHLEVBQU9ELEVBQVEsR0FDZnJFLEVBQVdxRSxFQUFRLEdBRWxCckUsSUFDREEsRUFBV3NFLEVBQ1hBLEVBQU8sTUFHWCxJQUFJQyxFQUFZL0QsU0FBU2dFLGVBQ3JCeEUsRUFBU2xDLFFBQVEsV0FBWSxLQUdqQyxHQUFLeUcsRUFBTCxDQUlBLElBQUlFLEVBQWlCLE1BQU1oQixLQUFLekQsR0FBWSxJQUFNLEdBQzlDMEUsRUFBZ0IsTUFBTWpCLEtBQUt6RCxHQUFZLElBQU0sR0E2QmpELE9BM0JBbUUsRUFBY0ksRUFBS25JLE1BRW5CbUksRUFBS0ksaUJBQWlCLFFBQVMsU0FBQUMsR0FDM0IsSUFBSXhJLEVBQVF3SSxFQUFNQyxPQUFPekksTUFFekJ3RSxFQUFLbEIsTUFBTXhELElBQUk2SCxHQUFjbEcsS0FBTytDLEVBQUtsQixNQUNwQ3hELElBQUk2SCxHQUNKSCxhQUFhaEUsT0FBTyxTQUFBL0IsR0FDakIsSUFBSWlILEVBQVUsSUFBSUMsT0FDZE4sRUFBaUJySSxFQUFRc0ksRUFDekIsTUFHSixHQUFJSixFQUNBLE9BQU9RLEVBQVFyQixLQUFLNUYsRUFBS3lHLElBRzdCLElBQUssSUFBTVUsS0FBU25ILEVBQ2hCLEdBQUlpSCxFQUFRckIsS0FBSzVGLEVBQUttSCxJQUNsQixPQUFPLElBS3ZCcEUsRUFBS3FELFNBQVNGLEVBQWN0RixLQUd6QlksT0FPWDJFLEVBQUF2SCxVQUFBMkgsU0FBQSxTQUFTTCxFQUFzQkksR0FDM0IsWUFBcUJqRSxJQUFqQjZELE9BS0NoRyxFQUFBLEVBQVNULFFBQVFFLEdBQUdpRyxLQUFLVSxLQUN6QnBHLEVBQUEsRUFBU04sZUFBZWdHLEtBQUtVLEVBQVlyRyxRQUFRLFNBQVUsWUFGaEUsSUFRSWtHLEVBQUF2SCxVQUFBeUgsWUFBUixXQVFJLElBUkosSUFLUXpGLEVBQ0F3RyxFQU5SckUsRUFBQXZCLEtBQ1E2RixFQUFvQzFFLFNBQVNDLGlCQUM3QyxpQkFNS3pGLEVBQUksRUFBSXlELEVBQVV5RyxFQUFhbEssR0FBS0EsSUFDekNpSyxFQUFjeEcsRUFBUTBDLFFBQVE5QixLQUFLQyxxQkFBcUJuQixNQUNwREosRUFBQSxFQUFTZixZQUdieUIsRUFBUTBDLFFBQVF2QixPQUNYekIsTUFBTUosRUFBQSxFQUFTYixnQkFDZndFLFFBQVEsU0FBQTlCLEdBQ0xnQixFQUFLaEIsT0FBT3FGLEVBQVksR0FBSXJGLEVBQVFuQixNQUl4RHVGLEVBaklBIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFtdLCBmYWN0b3J5KTtcblx0ZWxzZSB7XG5cdFx0dmFyIGEgPSBmYWN0b3J5KCk7XG5cdFx0Zm9yKHZhciBpIGluIGEpICh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgPyBleHBvcnRzIDogcm9vdClbaV0gPSBhW2ldO1xuXHR9XG59KSh3aW5kb3csIGZ1bmN0aW9uKCkge1xucmV0dXJuICIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbiBcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG4gXHRcdFx0XHRnZXQ6IGdldHRlclxuIFx0XHRcdH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gNSk7XG4iLCJleHBvcnQgY29uc3QgcGF0dGVybnMgPSB7XG4gICAga2V5VHlwZUFycmF5OiAvXFxbXFxzKihcXGQrKVxccypcXF0rL2csXG4gICAgcGFyYW1zOiAvXFx7XFxzKihcXGQrKVxccypcXH0rL2csXG4gICAgc3BsaXRRdWVyeTogL1xccytpblxccysvLFxuICAgIGZpbmRUZW1wbGF0ZVZhcnM6IC9cXHtcXHtcXHMqKFtcXFtcXF1cXCRcXC5cXF8wLTlhLXpBLVpdKylcXHMqXFx9XFx9L2csXG4gICAgc3BsaXRRdWVyeVZhcnM6IC9cXHMqLFxccyovLFxuICAgIGlzQXJyYXlTaW50YXg6IHtcbiAgICAgICAgaW5pOiAvKD89XlxccypcXFspLyxcbiAgICAgICAgZW5kOiAvKD89XFxdXFxzKiQpL1xuICAgIH0sXG4gICAgZmlsdGVyczoge1xuICAgICAgICBsaWtlOiAvXFxzK2xpa2VcXHMrLyxcbiAgICAgICAgYXM6IC9cXHMrYXNcXHMrL1xuICAgIH0sXG4gICAgaGFzU2VsZWN0b3JDc3M6IC9eKCN8XFwuKVxcUy9cbn07XG4iLCJpbXBvcnQgeyBwYXR0ZXJucyB9IGZyb20gJy4vcGF0dGVybnMnO1xuXG5leHBvcnQgY2xhc3MgSGVscGVycyB7XG4gICAgLyoqXG4gICAgICogSW5qZWN0b3IgZGUgZGF0b3MgZGVudHJvIGRlIHVuIHRlbXBsYXRlXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAbWV0aG9kXG4gICAgICovXG4gICAgc3RhdGljIHJlbmRlclRlbXBsYXRlKHRlbXBsYXRlLCBkYXRhKSB7XG4gICAgICAgIHJldHVybiB0ZW1wbGF0ZVxuICAgICAgICAgICAgLnJlcGxhY2UocGF0dGVybnMua2V5VHlwZUFycmF5LCAnLiQxJylcbiAgICAgICAgICAgIC5yZXBsYWNlKHBhdHRlcm5zLmZpbmRUZW1wbGF0ZVZhcnMsIChmaW5kLCBrZXkpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgcGFydHNLZXkgPSBrZXkuc3BsaXQoJy4nKTtcbiAgICAgICAgICAgICAgICBsZXQgZmluZGVyID0gZGF0YVtwYXJ0c0tleVswXV07XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpZHggPSAxOyBpZHggPCBwYXJ0c0tleS5sZW5ndGg7IGlkeCsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbmRlciA9IGZpbmRlcltwYXJ0c0tleVtpZHhdXTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoZmluZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmaW5kZXI7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbmQ7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzdGF0aWMgaW5zZXJ0QWZ0ZXIoaW5zZXJ0RWxlbWVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZWxlbWVudC5uZXh0U2libGluZykge1xuICAgICAgICAgICAgZWxlbWVudC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShpbnNlcnRFbGVtZW50LCBlbGVtZW50Lm5leHRTaWJsaW5nKTtcblxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxlbWVudC5wYXJlbnROb2RlLmFwcGVuZENoaWxkKGluc2VydEVsZW1lbnQpO1xuICAgIH1cblxuICAgIHN0YXRpYyBpc09mVHlwZShkYXRhLCBjb21wYXJlKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICB7fS50b1N0cmluZ1xuICAgICAgICAgICAgICAgIC5jYWxsKGRhdGEpXG4gICAgICAgICAgICAgICAgLm1hdGNoKC9cXHMoLispXFxdJC8pWzFdXG4gICAgICAgICAgICAgICAgLnRvTG93ZXJDYXNlKCkgPT09IGNvbXBhcmVcbiAgICAgICAgKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBwYXR0ZXJucyB9IGZyb20gJy4vcGF0dGVybnMnO1xuaW1wb3J0IHsgRmlsdGVyIH0gZnJvbSAnLi9maWx0ZXInO1xuaW1wb3J0IHsgSGVscGVycyB9IGZyb20gJy4vaGVscGVycyc7XG5pbXBvcnQgeyBTY29wZSB9IGZyb20gJy4vc2NvcGUnO1xuXG5leHBvcnQgY2xhc3MgUmVwZWF0SHRtbCB7XG4gICAgZmlsdGVyOiBGaWx0ZXI7XG4gICAgb3JpZ2luYWxFbGVtZW50czogYW55W107XG4gICAgcmVwZWF0QXR0cmlidXRlTmFtZTogc3RyaW5nO1xuICAgIHNlbGVjdG9yOiBzdHJpbmc7XG4gICAgX3Njb3BlOiBTY29wZTtcblxuICAgIGNvbnN0cnVjdG9yKGNvbmZpZzogYW55ID0ge30pIHtcbiAgICAgICAgdGhpcy5yZXBlYXRBdHRyaWJ1dGVOYW1lID0gY29uZmlnLmF0dHJOYW1lIHx8ICdyZXBlYXQnO1xuICAgICAgICB0aGlzLl9zY29wZSA9IG5ldyBTY29wZShjb25maWcuc2NvcGUpO1xuICAgICAgICB0aGlzLm9yaWdpbmFsRWxlbWVudHMgPSBudWxsO1xuXG4gICAgICAgIHRoaXMuZmlsdGVyID0gbmV3IEZpbHRlcihcbiAgICAgICAgICAgIHRoaXMuX3Njb3BlLFxuICAgICAgICAgICAgdGhpcy5yZXBlYXRBdHRyaWJ1dGVOYW1lLFxuICAgICAgICAgICAgdGhpcy5yZWZyZXNoLmJpbmQodGhpcylcbiAgICAgICAgKTtcblxuICAgICAgICB0aGlzLnNlbGVjdG9yID0gJ1tkYXRhLScgKyB0aGlzLnJlcGVhdEF0dHJpYnV0ZU5hbWUgKyAnXSc7XG5cbiAgICAgICAgaWYgKGNvbmZpZy5jb21waWxlIHx8IGNvbmZpZy5jb21waWxlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaW5pdChmYWxzZSwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWV0b2RvIGRlIGVudHJhZGEgbyBzYWxpZGEgZGUgZGF0b3MgZGVsIF9zY29wZVxuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAbWV0aG9kXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdmFyTmFtZSAtIE5vbWJyZSBkZWwgZGF0byBhIGFsbWFjZW5hciBkZW50cm8gZGVsIHNjb3BlXG4gICAgICogQHBhcmFtIHthbnlbXX0gZGF0YSAtIEluZm9ybWFjaW9uIG8gZGF0b3MgYSBhbG1hY2VuYXJcbiAgICAgKiBAcGFyYW0ge09iamVjdHxGdW5jdGlvbnxBcnJheX0gZnVuY0JhY2tzIC0gRnVuY2lvbmVzIHF1ZSBzZSBlamVjdXRhcmFuIGFsIGFjdHVhbGl6YXIgZWwgbW9kZWxvIGRlIGRhdG9zXG4gICAgICovXG4gICAgc2NvcGUodmFyTmFtZTogc3RyaW5nLCBkYXRhLCBmdW5jQmFja3M/KSB7XG4gICAgICAgIGlmIChkYXRhID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zY29wZS5nZXQodmFyTmFtZSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9zY29wZS5hZGQodmFyTmFtZSwgZGF0YSwgZnVuY0JhY2tzKTtcbiAgICAgICAgdGhpcy5yZWZyZXNoKHZhck5hbWUpO1xuICAgICAgICB0aGlzLl9zY29wZS5nZXQodmFyTmFtZSkuZnVuY0JhY2tBZnRlci5jYWxsKHRoaXMsIGRhdGEpO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFwbGljYXIgYWNjaW9uIGRlIHJlcGV0aXJcbiAgICAgKiBAcHVibGljXG4gICAgICogQG1ldGhvZFxuICAgICAqL1xuICAgIHJlZnJlc2godmFyTmFtZSwgZWxlbWVudD8pIHtcbiAgICAgICAgbGV0IGhhc0RhdGFSZXBlYXRBdHRyaWJ1dGUgPVxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLnNlbGVjdG9yKS5sZW5ndGggPiAwO1xuXG4gICAgICAgIGlmIChoYXNEYXRhUmVwZWF0QXR0cmlidXRlKSB7XG4gICAgICAgICAgICB0aGlzLmluaXQoZmFsc2UsIGZhbHNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucmVSZW5kZXIodmFyTmFtZSwgZWxlbWVudCk7XG5cbiAgICAgICAgLy9jbGVhcigpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXBpdGFkbyBkZSBsb3MgZGF0b3NcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBtZXRob2RcbiAgICAgKi9cbiAgICByZVJlbmRlcih2YXJOYW1lLCBlbGVtZW50KSB7XG4gICAgICAgIGxldCBlbGVtZW50cyA9IHRoaXMub3JpZ2luYWxFbGVtZW50cztcbiAgICAgICAgbGV0IHJlcGVhdERhdGEgPSBudWxsO1xuICAgICAgICBsZXQgZWxlbWVudERhdGE7XG4gICAgICAgIGxldCBlbGVtZW50c1JlcGVhdENvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG5cbiAgICAgICAgbGV0IGZ1bmNCYWNrQXJncyA9IFtdO1xuICAgICAgICBsZXQgbW9kZWxEYXRhID0gdGhpcy5fc2NvcGUuZ2V0KHZhck5hbWUpO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGVsZW1lbnREYXRhID0gZWxlbWVudHNbaV07XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBlbGVtZW50ICYmXG4gICAgICAgICAgICAgICAgZWxlbWVudC5kYXRhc2V0LmZpbHRlciAhPT0gZWxlbWVudERhdGEuZWxlbWVudC5kYXRhc2V0LmZpbHRlclxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlcGVhdERhdGEgPSB0aGlzLnJlc29sdmVRdWVyeShcbiAgICAgICAgICAgICAgICBlbGVtZW50RGF0YS5lbGVtZW50LmRhdGFzZXRbdGhpcy5yZXBlYXRBdHRyaWJ1dGVOYW1lXVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWYgKCFyZXBlYXREYXRhLmRhdGFzIHx8IHZhck5hbWUgIT09IHJlcGVhdERhdGEudmFyTmFtZSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsZXQgZWxlbWVudEhUTUwgPSBlbGVtZW50RGF0YS5lbGVtZW50LmlubmVySFRNTDtcblxuICAgICAgICAgICAgZWxlbWVudERhdGEuY2hpbGRzLmZvckVhY2goKGNoaWxkLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZWxlbWVudERhdGEucGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZChjaGlsZCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudERhdGEuY2hpbGRzLnNwbGljZSgxLCBlbGVtZW50RGF0YS5jaGlsZHMubGVuZ3RoKTtcblxuICAgICAgICAgICAgcmVwZWF0RGF0YS5kYXRhcy5mb3JFYWNoKGRhdGEgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBlbGVtZW50Q2xvbiA9IGVsZW1lbnREYXRhLmVsZW1lbnRDbG9uZS5jbG9uZU5vZGUoZmFsc2UpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudENsb24uaW5uZXJIVE1MID0gSGVscGVycy5yZW5kZXJUZW1wbGF0ZShlbGVtZW50SFRNTCwge1xuICAgICAgICAgICAgICAgICAgICBbcmVwZWF0RGF0YS52YXJzSXRlcmF0ZV06IGRhdGFcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnRzUmVwZWF0Q29udGVudC5hcHBlbmRDaGlsZChlbGVtZW50Q2xvbik7XG4gICAgICAgICAgICAgICAgZWxlbWVudERhdGEuY2hpbGRzLnB1c2goZWxlbWVudENsb24pO1xuXG4gICAgICAgICAgICAgICAgaWYgKG1vZGVsRGF0YS5mdW5jQmFjaykge1xuICAgICAgICAgICAgICAgICAgICBmdW5jQmFja0FyZ3MucHVzaChbZGF0YSwgZWxlbWVudENsb25dKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgSGVscGVycy5pbnNlcnRBZnRlcihlbGVtZW50c1JlcGVhdENvbnRlbnQsIGVsZW1lbnREYXRhLmNoaWxkc1swXSk7XG4gICAgICAgICAgICBlbGVtZW50c1JlcGVhdENvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoISF2YXJOYW1lICYmIG1vZGVsRGF0YS5mdW5jQmFjaykge1xuICAgICAgICAgICAgZnVuY0JhY2tBcmdzLmZvckVhY2goYXJncyA9PiB7XG4gICAgICAgICAgICAgICAgbW9kZWxEYXRhLmZ1bmNCYWNrLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNZXRvZG8gZGUgZW50cmFkYSBvIHNhbGlkYSBkZWwgc2NvcGVcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBtZXRob2RcbiAgICAgKi9cbiAgICBpbml0KGlzUmVmcmVzaCwgZmluZFBhcmVudHMpIHtcbiAgICAgICAgbGV0IGVsZW1lbnRzOiBhbnkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFxuICAgICAgICAgICAgdGhpcy5zZWxlY3RvciArIChmaW5kUGFyZW50cyA/ICcnIDogJyAnICsgdGhpcy5zZWxlY3RvcilcbiAgICAgICAgKTtcbiAgICAgICAgbGV0IGVsZW1lbnQgPSBudWxsO1xuICAgICAgICBsZXQgcmVwZWF0RGF0YSA9IG51bGw7XG4gICAgICAgIGxldCBsZW5FbGVtZW50cyA9IDA7XG4gICAgICAgIGxldCBlbGVtZW50c1JlcGVhdENvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG5cbiAgICAgICAgaWYgKCF0aGlzLm9yaWdpbmFsRWxlbWVudHMpIHtcbiAgICAgICAgICAgIHRoaXMub3JpZ2luYWxFbGVtZW50cyA9IFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgZWxlbWVudCA9IGVsZW1lbnRzW2ldLmVsZW1lbnQgfHwgZWxlbWVudHNbaV07XG5cbiAgICAgICAgICAgIHJlcGVhdERhdGEgPSB0aGlzLnJlc29sdmVRdWVyeShcbiAgICAgICAgICAgICAgICBlbGVtZW50LmRhdGFzZXRbdGhpcy5yZXBlYXRBdHRyaWJ1dGVOYW1lXVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWYgKCFyZXBlYXREYXRhLmRhdGFzKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCBlbGVtZW50SHRtbCA9IGVsZW1lbnQuaW5uZXJIVE1MO1xuXG4gICAgICAgICAgICBsZXQgZWxlbWVudENvcHkgPSBlbGVtZW50LmNsb25lTm9kZSh0cnVlKSxcbiAgICAgICAgICAgICAgICBjb21tZW50U3RhcnQgPSBkb2N1bWVudC5jcmVhdGVDb21tZW50KFxuICAgICAgICAgICAgICAgICAgICAnUmVwZWF0SFRNTDogc3RhcnQoICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5kYXRhc2V0W3RoaXMucmVwZWF0QXR0cmlidXRlTmFtZV0gK1xuICAgICAgICAgICAgICAgICAgICAgICAgJyApJ1xuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGVsZW1lbnRDb3B5LnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS0nICsgdGhpcy5yZXBlYXRBdHRyaWJ1dGVOYW1lKTtcbiAgICAgICAgICAgIGVsZW1lbnRDb3B5LnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1maWx0ZXInKTtcblxuICAgICAgICAgICAgaWYgKCFpc1JlZnJlc2gpIHtcbiAgICAgICAgICAgICAgICAvL0FsbWFjZW5hciBjYWRhIGVsZW1lbnRvIG9yaWdpbmFsIGVuIHVuYSBhcnJlZ2xvXG4gICAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbEVsZW1lbnRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50LmNsb25lTm9kZSh0cnVlKSxcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudENsb25lOiBlbGVtZW50Q29weSxcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50RWxlbWVudDogZWxlbWVudC5wYXJlbnRFbGVtZW50LFxuICAgICAgICAgICAgICAgICAgICBjaGlsZHM6IFtjb21tZW50U3RhcnRdXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBsZW5FbGVtZW50cyA9IHRoaXMub3JpZ2luYWxFbGVtZW50cy5sZW5ndGg7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsZW1lbnRzUmVwZWF0Q29udGVudC5hcHBlbmRDaGlsZChjb21tZW50U3RhcnQpO1xuXG4gICAgICAgICAgICAvL0NvbWVudGFyaW8gZGVsaW1pdGFkb3IgZGUgaW5pY2lvXG4gICAgICAgICAgICByZXBlYXREYXRhLmRhdGFzLmZvckVhY2goZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGVsZW1lbnRDbG9uZWQgPSBlbGVtZW50Q29weS5jbG9uZU5vZGUoZmFsc2UpO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudENsb25lZC5pbm5lckhUTUwgPSBIZWxwZXJzLnJlbmRlclRlbXBsYXRlKGVsZW1lbnRIdG1sLCB7XG4gICAgICAgICAgICAgICAgICAgIFtyZXBlYXREYXRhLnZhcnNJdGVyYXRlXTogZGF0YVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudHNSZXBlYXRDb250ZW50LmFwcGVuZENoaWxkKGVsZW1lbnRDbG9uZWQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFpc1JlZnJlc2gpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbEVsZW1lbnRzW2xlbkVsZW1lbnRzIC0gMV0uY2hpbGRzLnB1c2goXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50Q2xvbmVkXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQucGFyZW50RWxlbWVudC5yZXBsYWNlQ2hpbGQoZWxlbWVudHNSZXBlYXRDb250ZW50LCBlbGVtZW50KTtcbiAgICAgICAgICAgIGVsZW1lbnRzUmVwZWF0Q29udGVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5zZWxlY3RvcikubGVuZ3RoID4gMCAmJlxuICAgICAgICAgICAgIWZpbmRQYXJlbnRzXG4gICAgICAgICkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5pdChpc1JlZnJlc2gsIHRydWUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzdWVsdmUgbGEgY2FkZW5hIGRlIHRleHRvIGRlbCByZXBlYXQgYSBkb3MgcHJvcGllZGFkZXNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBtZXRob2RcbiAgICAgKi9cbiAgICByZXNvbHZlUXVlcnkocXVlcnkpIHtcbiAgICAgICAgcXVlcnkgPSBxdWVyeS5zcGxpdChwYXR0ZXJucy5zcGxpdFF1ZXJ5KTtcblxuICAgICAgICBpZiAocXVlcnlbMF0udHJpbSgpID09PSAnJyAmJiAhcXVlcnlbMV0pIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdmFyc0l0ZXJhdGU6IG51bGwsXG4gICAgICAgICAgICAgICAgZGF0YXM6IG51bGwsXG4gICAgICAgICAgICAgICAgdmFyTmFtZTogbnVsbFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2YXJzSXRlcmF0ZTogcXVlcnlbMF0uc3BsaXQocGF0dGVybnMuc3BsaXRRdWVyeVZhcnMpLFxuICAgICAgICAgICAgZGF0YXM6IHRoaXMucGFyc2VEYXRhLmNhbGwodGhpcywgcXVlcnlbMV0udHJpbSgpKSxcbiAgICAgICAgICAgIHZhck5hbWU6IHF1ZXJ5WzFdLnRyaW0oKVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvZGlmaWNhIGxvcyBkYXRvcyBkZSBlbnRyYWRhIGRlcGVuZGllbmRvIGRlbCB0aXBvLCBhcnJheSBvIHN0cmluZ1xuICAgICAqIEBwcml2YXRlXG4gICAgICogQG1ldGhvZFxuICAgICAqL1xuICAgIHBhcnNlRGF0YShzdHJEYXRhKSB7XG4gICAgICAgIGlmICh0aGlzLl9zY29wZS5nZXQoc3RyRGF0YSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbHRlci5hcHBseShzdHJEYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIHBhdHRlcm5zLmlzQXJyYXlTaW50YXguaW5pLnRlc3Qoc3RyRGF0YSkgJiZcbiAgICAgICAgICAgIHBhdHRlcm5zLmlzQXJyYXlTaW50YXguZW5kLnRlc3Qoc3RyRGF0YSlcbiAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm4gZXZhbChzdHJEYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IEhlbHBlcnMgfSBmcm9tICcuL2hlbHBlcnMnO1xuXG5leHBvcnQgY2xhc3MgU2NvcGUge1xuICAgIHByaXZhdGUgX3Njb3BlOiB7XG4gICAgICAgIGRhdGE6IGFueTtcbiAgICAgICAgb3JpZ2luYWxEYXRhOiBhbnk7XG4gICAgICAgIGZ1bmNCYWNrQWZ0ZXI6IEZ1bmN0aW9uO1xuICAgICAgICBmdW5jQmFjazogRnVuY3Rpb247XG4gICAgfTtcblxuICAgIGNvbnN0cnVjdG9yKHNjb3BlKSB7XG4gICAgICAgIHRoaXMuX3Njb3BlID0gc2NvcGUgfHwge307XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWV0b2RvIGRlIGVudHJhZGEgbyBzYWxpZGEgZGUgZGF0b3MgZGVsIF9zY29wZVxuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAbWV0aG9kXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdmFyTmFtZSAtIE5vbWJyZSBkZWwgZGF0byBhIGFsbWFjZW5hciBkZW50cm8gZGVsIHNjb3BlXG4gICAgICogQHBhcmFtIHthbnlbXX0gZGF0YSAtIEluZm9ybWFjaW9uIG8gZGF0b3MgYSBhbG1hY2VuYXJcbiAgICAgKiBAcGFyYW0ge09iamVjdHxGdW5jdGlvbnxBcnJheX0gZnVuY0JhY2tzIC0gRnVuY2lvbmVzIHF1ZSBzZSBlamVjdXRhcmFuIGFsIGFjdHVhbGl6YXIgZWwgbW9kZWxvIGRlIGRhdG9zXG4gICAgICovXG4gICAgYWRkKHZhck5hbWU6IHN0cmluZywgZGF0YSwgZnVuY0JhY2tzPykge1xuICAgICAgICB0aGlzLl9zY29wZVt2YXJOYW1lXSA9IHRoaXMuX3Njb3BlW3Zhck5hbWVdIHx8IHt9O1xuICAgICAgICB0aGlzLl9zY29wZVt2YXJOYW1lXS5kYXRhID0gZGF0YTtcbiAgICAgICAgdGhpcy5fc2NvcGVbdmFyTmFtZV0ub3JpZ2luYWxEYXRhID0gZGF0YTtcbiAgICAgICAgdGhpcy5fc2NvcGVbdmFyTmFtZV0uZnVuY0JhY2tBZnRlciA9ICgpID0+IHt9O1xuICAgICAgICB0aGlzLl9zY29wZVt2YXJOYW1lXS5mdW5jQmFjayA9ICgpID0+IHt9O1xuXG4gICAgICAgIGlmICh0eXBlb2YgZnVuY0JhY2tzID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICB0aGlzLl9zY29wZVt2YXJOYW1lXS5mdW5jQmFja0FmdGVyID0gZnVuY0JhY2tzO1xuICAgICAgICB9IGVsc2UgaWYgKEhlbHBlcnMuaXNPZlR5cGUoZnVuY0JhY2tzLCAnYXJyYXknKSkge1xuICAgICAgICAgICAgdGhpcy5fc2NvcGVbdmFyTmFtZV0uZnVuY0JhY2tBZnRlciA9IGZ1bmNCYWNrc1swXTtcbiAgICAgICAgICAgIHRoaXMuX3Njb3BlW3Zhck5hbWVdLmZ1bmNCYWNrID0gZnVuY0JhY2tzWzFdO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBmdW5jQmFja3MgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICB0aGlzLl9zY29wZVt2YXJOYW1lXS5mdW5jQmFja0FmdGVyID0gZnVuY0JhY2tzLmFmdGVyO1xuICAgICAgICAgICAgdGhpcy5fc2NvcGVbdmFyTmFtZV0uZnVuY0JhY2sgPSBmdW5jQmFja3MuZnVuY0JhY2s7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBnZXQodmFyaWFibGVOYW1lKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zY29wZVt2YXJpYWJsZU5hbWVdO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IHBhdHRlcm5zIH0gZnJvbSAnLi9wYXR0ZXJucyc7XG5pbXBvcnQgeyBTY29wZSB9IGZyb20gJy4vc2NvcGUnO1xuXG5leHBvcnQgY2xhc3MgRmlsdGVyIHtcbiAgICBwcm90ZWN0ZWQgY2FsbGJhY2s6IEZ1bmN0aW9uO1xuICAgIHByb3RlY3RlZCBzY29wZTogU2NvcGU7XG4gICAgcHJvdGVjdGVkIHJlcGVhdEF0dHJpYnV0ZU5hbWU6IHN0cmluZztcbiAgICBwcm90ZWN0ZWQgZmlsdGVycztcblxuICAgIGNvbnN0cnVjdG9yKHNjb3BlOiBTY29wZSwgcmVwZWF0QXR0cmlidXRlTmFtZTogc3RyaW5nLCBjYWxsYmFjaykge1xuICAgICAgICB0aGlzLnNjb3BlID0gc2NvcGU7XG4gICAgICAgIHRoaXMucmVwZWF0QXR0cmlidXRlTmFtZSA9IHJlcGVhdEF0dHJpYnV0ZU5hbWU7XG4gICAgICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICAgICAgdGhpcy5maWx0ZXJzID0ge307XG5cbiAgICAgICAgdGhpcy5maW5kRmlsdGVycygpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpbHRyYXIgbGEgbGlzdGEgZGUgZGF0b3MgZGVwZW5kaWVuZG8gZGVsIHBhcmFtZXRybyBkYWRvXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBtZXRob2RcbiAgICAgKi9cbiAgICBhcHBseSh2YXJOYW1lKSB7XG4gICAgICAgIGlmICghdmFyTmFtZSB8fCAhdGhpcy5maWx0ZXJzW3Zhck5hbWVdKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zY29wZS5nZXQodmFyTmFtZSkuZGF0YTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLnNjb3BlLmdldCh2YXJOYW1lKS5kYXRhLmZpbHRlcih0aGlzLmZpbHRlcnNbdmFyTmFtZV0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2YXJpYWJsZU5hbWVcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZmlsdGVyVmFsdWVcbiAgICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50XG4gICAgICogQHJldHVybnNcbiAgICAgKi9cbiAgICBmaWx0ZXIodmFyaWFibGVOYW1lOiBzdHJpbmcsIGZpbHRlclZhbHVlOiBzdHJpbmcsIGVsZW1lbnQ6IEhUTUxFbGVtZW50KSB7XG4gICAgICAgIGZpbHRlclZhbHVlID0gZmlsdGVyVmFsdWUudHJpbSgpO1xuXG4gICAgICAgIGlmICh0aGlzLnZhbGlkYXRlKHZhcmlhYmxlTmFtZSwgZmlsdGVyVmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgX2ZpbHRlciA9IGZpbHRlclZhbHVlLnNwbGl0KHBhdHRlcm5zLmZpbHRlcnMuYXMpO1xuXG4gICAgICAgIGxldCBwcm9wID0gX2ZpbHRlclswXTtcbiAgICAgICAgbGV0IHNlbGVjdG9yID0gX2ZpbHRlclsxXTtcblxuICAgICAgICBpZiAoIXNlbGVjdG9yKSB7XG4gICAgICAgICAgICBzZWxlY3RvciA9IHByb3A7XG4gICAgICAgICAgICBwcm9wID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBlbGVtOiBhbnkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcbiAgICAgICAgICAgIHNlbGVjdG9yLnJlcGxhY2UoLyN8XiV8JSQvZywgJycpXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKCFlbGVtKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgaGFzUGVyY2VudEluaXQgPSAvXiUvZy50ZXN0KHNlbGVjdG9yKSA/ICdeJyA6ICcnO1xuICAgICAgICBsZXQgaGFzUGVyY2VudEVuZCA9IC8lJC9nLnRlc3Qoc2VsZWN0b3IpID8gJyQnIDogJyc7XG5cbiAgICAgICAgZmlsdGVyVmFsdWUgPSBlbGVtLnZhbHVlOyAvL3BhcmEgbGxhbWFybG8gdW5hIHByaW1lcmEgdmV6XG5cbiAgICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGV2ZW50ID0+IHtcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IGV2ZW50LnRhcmdldC52YWx1ZTtcblxuICAgICAgICAgICAgdGhpcy5zY29wZS5nZXQodmFyaWFibGVOYW1lKS5kYXRhID0gdGhpcy5zY29wZVxuICAgICAgICAgICAgICAgIC5nZXQodmFyaWFibGVOYW1lKVxuICAgICAgICAgICAgICAgIC5vcmlnaW5hbERhdGEuZmlsdGVyKGRhdGEgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsZXQgcGF0dGVybiA9IG5ldyBSZWdFeHAoXG4gICAgICAgICAgICAgICAgICAgICAgICBoYXNQZXJjZW50SW5pdCArIHZhbHVlICsgaGFzUGVyY2VudEVuZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdnaSdcbiAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAocHJvcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhdHRlcm4udGVzdChkYXRhW3Byb3BdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgX3Byb3AgaW4gZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhdHRlcm4udGVzdChkYXRhW19wcm9wXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLmNhbGxiYWNrKHZhcmlhYmxlTmFtZSwgZWxlbWVudCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB2YXJpYWJsZU5hbWVcbiAgICAgKiBAcGFyYW0gZmlsdGVyVmFsdWVcbiAgICAgKi9cbiAgICB2YWxpZGF0ZSh2YXJpYWJsZU5hbWU6IHN0cmluZywgZmlsdGVyVmFsdWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAodmFyaWFibGVOYW1lID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgICFwYXR0ZXJucy5maWx0ZXJzLmFzLnRlc3QoZmlsdGVyVmFsdWUpICYmXG4gICAgICAgICAgICAhcGF0dGVybnMuaGFzU2VsZWN0b3JDc3MudGVzdChmaWx0ZXJWYWx1ZS5yZXBsYWNlKC9eJXwlJC9nLCAnJykpXG4gICAgICAgICkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmaW5kRmlsdGVycygpIHtcbiAgICAgICAgbGV0IHF1ZXJ5RmlsdGVyczogTm9kZUxpc3RPZjxFbGVtZW50PiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXG4gICAgICAgICAgICAnW2RhdGEtZmlsdGVyXSdcbiAgICAgICAgKTtcblxuICAgICAgICBsZXQgZWxlbWVudDogYW55O1xuICAgICAgICBsZXQgcXVlcnlSZXBlYXQ6IHN0cmluZztcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgKGVsZW1lbnQgPSBxdWVyeUZpbHRlcnNbaV0pOyBpKyspIHtcbiAgICAgICAgICAgIHF1ZXJ5UmVwZWF0ID0gZWxlbWVudC5kYXRhc2V0W3RoaXMucmVwZWF0QXR0cmlidXRlTmFtZV0uc3BsaXQoXG4gICAgICAgICAgICAgICAgcGF0dGVybnMuc3BsaXRRdWVyeVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgZWxlbWVudC5kYXRhc2V0LmZpbHRlclxuICAgICAgICAgICAgICAgIC5zcGxpdChwYXR0ZXJucy5zcGxpdFF1ZXJ5VmFycylcbiAgICAgICAgICAgICAgICAuZm9yRWFjaChmaWx0ZXIgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbHRlcihxdWVyeVJlcGVhdFsxXSwgZmlsdGVyLCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=