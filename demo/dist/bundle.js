!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}([function(e,t,r){"use strict";r.d(t,"a",function(){return n});var n={keyTypeArray:/\[\s*(\d+)\s*\]+/g,params:/\{\s*(\d+)\s*\}+/g,splitQuery:/\s+in\s+/,findTemplateVars:/\{\{\s*([\[\]\$\.\_0-9a-zA-Z]+)\s*\}\}/g,splitQueryVars:/\s*,\s*/,isArraySintax:{ini:/(?=^\s*\[)/,end:/(?=\]\s*$)/},filters:{like:/\s+like\s+/,as:/\s+as\s+/},hasSelectorCss:/^(#|\.)\S/}},function(e,t,r){"use strict";r.d(t,"a",function(){return a});var n=r(0),a=function(){function e(){}return e.renderTemplate=function(e,t){return e.replace(n.a.keyTypeArray,".$1").replace(n.a.findTemplateVars,function(e,r){for(var n=r.split("."),a=t[n[0]],i=1;i<n.length;i++)a=a[n[i]];return a||e})},e.insertAfter=function(e,t){t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e)},e.isOfType=function(e,t){return{}.toString.call(e).match(/\s(.+)\]$/)[1].toLowerCase()===t},e}()},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return RepeatHtml});var _patterns__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_filter__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_helpers__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),RepeatHtml=function(){function RepeatHtml(e){void 0===e&&(e={}),this.repeatAttributeName=e.attrName||"repeat",this._scope=e.scope||{},this.originalElements=null,this.filter=new _filter__WEBPACK_IMPORTED_MODULE_1__.a(this._scope,this.repeatAttributeName,this.refresh.bind(this)),this.selector="[data-"+this.repeatAttributeName+"]",(e.compile||void 0===e.compile)&&this.init(!1,!1)}return RepeatHtml.prototype.scope=function(e,t,r){return void 0===t?this._scope[e]:(this._scope[e]=this._scope[e]||{},this._scope[e].data=t,this._scope[e].originalData=t,"function"==typeof r?this._scope[e].funcBackAfter=r:_helpers__WEBPACK_IMPORTED_MODULE_2__.a.isOfType(r,"array")?(this._scope[e].funcBackAfter=r[0],this._scope[e].funcBack=r[1]):"object"==typeof r&&(this._scope[e].funcBackAfter=r.after,this._scope[e].funcBack=r.funcBack),this.refresh(e),this._scope[e].funcBackAfter&&this._scope[e].funcBackAfter.call(this,t),this)},RepeatHtml.prototype.refresh=function(e,t){return document.querySelectorAll(this.selector).length>0&&this.init(!1,!1),this.reRender(e,t),this},RepeatHtml.prototype.reRender=function(e,t){for(var r,n=this,a=this.originalElements,i=null,s=document.createDocumentFragment(),o=[],l=this._scope[e],c=function(n){if(r=a[n],t&&t.dataset.filter!==r.element.dataset.filter)return"continue";if(!(i=u.resolveQuery(r.element.dataset[u.repeatAttributeName])).datas||e!==i.varName)return"continue";var c=r.element.innerHTML;r.childs.forEach(function(e,t){0!==t&&r.parentElement.removeChild(e)}),r.childs.splice(1,r.childs.length),i.datas.forEach(function(e){var t,n=r.elementClone.cloneNode(!1);n.innerHTML=_helpers__WEBPACK_IMPORTED_MODULE_2__.a.renderTemplate(c,((t={})[i.varsIterate]=e,t)),s.appendChild(n),r.childs.push(n),l.funcBack&&o.push([e,n])}),_helpers__WEBPACK_IMPORTED_MODULE_2__.a.insertAfter(s,r.childs[0]),s=document.createDocumentFragment()},u=this,p=0;p<a.length;p++)c(p);e&&l.funcBack&&o.forEach(function(e){l.funcBack.apply(n,e)})},RepeatHtml.prototype.init=function(e,t){var r=this,n=document.querySelectorAll(this.selector+(t?"":" "+this.selector)),a=null,i=null,s=0,o=document.createDocumentFragment();this.originalElements||(this.originalElements=[]);for(var l=function(t){if(a=n[t].element||n[t],!(i=c.resolveQuery(a.dataset[c.repeatAttributeName])).datas)return"continue";var l=a.innerHTML,u=a.cloneNode(!0),p=document.createComment("RepeatHTML: start( "+a.dataset[c.repeatAttributeName]+" )");u.removeAttribute("data-"+c.repeatAttributeName),u.removeAttribute("data-filter"),e||(c.originalElements.push({element:a.cloneNode(!0),elementClone:u,parentElement:a.parentElement,childs:[p]}),s=c.originalElements.length),o.appendChild(p),i.datas.forEach(function(t){var n,a=u.cloneNode(!1);a.innerHTML=_helpers__WEBPACK_IMPORTED_MODULE_2__.a.renderTemplate(l,((n={})[i.varsIterate]=t,n)),o.appendChild(a),e||r.originalElements[s-1].childs.push(a)}),a.parentElement.replaceChild(o,a),o=document.createDocumentFragment()},c=this,u=0;u<n.length;u++)l(u);if(document.querySelectorAll(this.selector).length>0&&!t)return this.init(e,!0)},RepeatHtml.prototype.resolveQuery=function(e){return""!==(e=e.split(_patterns__WEBPACK_IMPORTED_MODULE_0__.a.splitQuery))[0].trim()||e[1]?{varsIterate:e[0].split(_patterns__WEBPACK_IMPORTED_MODULE_0__.a.splitQueryVars),datas:this.parseData.call(this,e[1].trim()),varName:e[1].trim()}:{varsIterate:null,datas:null,varName:null}},RepeatHtml.prototype.parseData=function(strData){return this._scope[strData]?this.filter.apply(strData):_patterns__WEBPACK_IMPORTED_MODULE_0__.a.isArraySintax.ini.test(strData)&&_patterns__WEBPACK_IMPORTED_MODULE_0__.a.isArraySintax.end.test(strData)?eval(strData):null},RepeatHtml}()},function(e,t,r){"use strict";r.d(t,"a",function(){return a});var n=r(0),a=function(){function e(e,t,r){this.scope=e,this.repeatAttributeName=t,this.callback=r,this.filters={},this.findFilters()}return e.prototype.apply=function(e){return e&&this.filters[e]?this.scope[e].data.filter(this.filters[e]):this.scope[e].data},e.prototype.filter=function(e,t,r){var a=this;if(t=t.trim(),this.validate(e,t))return!1;var i=t.split(n.a.filters.as),s=i[0],o=i[1];o||(o=s,s=null);var l=document.getElementById(o.replace(/#|^%|%$/g,""));if(l){var c=/^%/g.test(o)?"^":"",u=/%$/g.test(o)?"$":"";return t=l.value,l.addEventListener("keyup",function(t){var n=t.target.value;a.scope[e].data=a.scope[e].originalData.filter(function(e){var t=new RegExp(c+n+u,"gi");if(s)return t.test(e[s]);for(var r in e)if(t.test(e[r]))return!0}),a.callback(e,r)}),this}},e.prototype.validate=function(e,t){return void 0!==e&&(!(!n.a.filters.as.test(t)&&!n.a.hasSelectorCss.test(t.replace(/^%|%$/g,"")))&&void 0)},e.prototype.findFilters=function(){for(var e,t,r=this,a=document.querySelectorAll("[data-filter]"),i=0;e=a[i];i++)t=e.dataset[this.repeatAttributeName].split(n.a.splitQuery),e.dataset.filter.split(n.a.splitQueryVars).forEach(function(n){r.filter(t[1],n,e)})},e}()},function(e,t,r){"use strict";r.r(t);var n=r(2);r.d(t,"RepeatHtml",function(){return n.a})}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovLy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly8vLi9zcmMvcGF0dGVybnMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2hlbHBlcnMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3JlcGVhdC1odG1sLnRzIiwid2VicGFjazovLy8uL3NyYy9maWx0ZXIudHMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwiZGVmaW5lIiwiYW1kIiwiYSIsImkiLCJ3aW5kb3ciLCJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImNvbmZpZ3VyYWJsZSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwidmFsdWUiLCJuIiwiX19lc01vZHVsZSIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsInBhdHRlcm5zIiwia2V5VHlwZUFycmF5IiwicGFyYW1zIiwic3BsaXRRdWVyeSIsImZpbmRUZW1wbGF0ZVZhcnMiLCJzcGxpdFF1ZXJ5VmFycyIsImlzQXJyYXlTaW50YXgiLCJpbmkiLCJlbmQiLCJmaWx0ZXJzIiwibGlrZSIsImFzIiwiaGFzU2VsZWN0b3JDc3MiLCJIZWxwZXJzIiwicmVuZGVyVGVtcGxhdGUiLCJ0ZW1wbGF0ZSIsImRhdGEiLCJyZXBsYWNlIiwiX3BhdHRlcm5zX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX18iLCJmaW5kIiwia2V5IiwicGFydHNLZXkiLCJzcGxpdCIsImZpbmRlciIsImlkeCIsImxlbmd0aCIsImluc2VydEFmdGVyIiwiaW5zZXJ0RWxlbWVudCIsImVsZW1lbnQiLCJuZXh0U2libGluZyIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiLCJhcHBlbmRDaGlsZCIsImlzT2ZUeXBlIiwiY29tcGFyZSIsInRvU3RyaW5nIiwibWF0Y2giLCJ0b0xvd2VyQ2FzZSIsIlJlcGVhdEh0bWwiLCJjb25maWciLCJ0aGlzIiwicmVwZWF0QXR0cmlidXRlTmFtZSIsImF0dHJOYW1lIiwiX3Njb3BlIiwic2NvcGUiLCJvcmlnaW5hbEVsZW1lbnRzIiwiZmlsdGVyIiwiX2ZpbHRlcl9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fIiwicmVmcmVzaCIsImJpbmQiLCJzZWxlY3RvciIsImNvbXBpbGUiLCJ1bmRlZmluZWQiLCJpbml0IiwidmFyTmFtZSIsImZ1bmNCYWNrcyIsIm9yaWdpbmFsRGF0YSIsImZ1bmNCYWNrQWZ0ZXIiLCJfaGVscGVyc19fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMl9fIiwiZnVuY0JhY2siLCJhZnRlciIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsInJlUmVuZGVyIiwiZWxlbWVudERhdGEiLCJfdGhpcyIsImVsZW1lbnRzIiwicmVwZWF0RGF0YSIsImVsZW1lbnRzUmVwZWF0Q29udGVudCIsImNyZWF0ZURvY3VtZW50RnJhZ21lbnQiLCJmdW5jQmFja0FyZ3MiLCJtb2RlbERhdGEiLCJkYXRhc2V0IiwidGhpc18xIiwicmVzb2x2ZVF1ZXJ5IiwiZGF0YXMiLCJlbGVtZW50SFRNTCIsImlubmVySFRNTCIsImNoaWxkcyIsImZvckVhY2giLCJjaGlsZCIsImluZGV4IiwicGFyZW50RWxlbWVudCIsInJlbW92ZUNoaWxkIiwic3BsaWNlIiwiZWxlbWVudENsb24iLCJlbGVtZW50Q2xvbmUiLCJjbG9uZU5vZGUiLCJfYSIsInZhcnNJdGVyYXRlIiwicHVzaCIsImFyZ3MiLCJhcHBseSIsImlzUmVmcmVzaCIsImZpbmRQYXJlbnRzIiwibGVuRWxlbWVudHMiLCJ0aGlzXzIiLCJlbGVtZW50SHRtbCIsImVsZW1lbnRDb3B5IiwiY29tbWVudFN0YXJ0IiwiY3JlYXRlQ29tbWVudCIsInJlbW92ZUF0dHJpYnV0ZSIsImVsZW1lbnRDbG9uZWQiLCJyZXBsYWNlQ2hpbGQiLCJxdWVyeSIsInRyaW0iLCJwYXJzZURhdGEiLCJzdHJEYXRhIiwidGVzdCIsImV2YWwiLCJGaWx0ZXIiLCJjYWxsYmFjayIsImZpbmRGaWx0ZXJzIiwidmFyaWFibGVOYW1lIiwiZmlsdGVyVmFsdWUiLCJ2YWxpZGF0ZSIsIl9maWx0ZXIiLCJwcm9wIiwiZWxlbSIsImdldEVsZW1lbnRCeUlkIiwiaGFzUGVyY2VudEluaXQiLCJoYXNQZXJjZW50RW5kIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwidGFyZ2V0IiwicGF0dGVybiIsIlJlZ0V4cCIsIl9wcm9wIiwicXVlcnlSZXBlYXQiLCJxdWVyeUZpbHRlcnMiXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBQ0Esb0JBQUFDLFNBQUEsaUJBQUFDLE9BQ0FBLE9BQUFELFFBQUFELFNBQ0Esc0JBQUFHLGVBQUFDLElBQ0FELFVBQUFILE9BQ0EsQ0FDQSxJQUFBSyxFQUFBTCxJQUNBLFFBQUFNLEtBQUFELEdBQUEsaUJBQUFKLGdCQUFBRixHQUFBTyxHQUFBRCxFQUFBQyxJQVBBLENBU0NDLE9BQUEsV0FDRCxtQkNUQSxJQUFBQyxLQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBVCxRQUdBLElBQUFDLEVBQUFNLEVBQUFFLElBQ0FKLEVBQUFJLEVBQ0FDLEdBQUEsRUFDQVYsWUFVQSxPQU5BVyxFQUFBRixHQUFBRyxLQUFBWCxFQUFBRCxRQUFBQyxJQUFBRCxRQUFBUSxHQUdBUCxFQUFBUyxHQUFBLEVBR0FULEVBQUFELFFBMkNBLE9BdENBUSxFQUFBSyxFQUFBRixFQUdBSCxFQUFBTSxFQUFBUCxFQUdBQyxFQUFBTyxFQUFBLFNBQUFmLEVBQUFnQixFQUFBQyxHQUNBVCxFQUFBVSxFQUFBbEIsRUFBQWdCLElBQ0FHLE9BQUFDLGVBQUFwQixFQUFBZ0IsR0FDQUssY0FB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QUFsSCxVQUFBdUgsU0FBQSxTQUFTRixFQUFzQkMsR0FDM0IsWUFBcUI5RCxJQUFqQjZELE9BS0MvRixFQUFBLEVBQVNULFFBQVFFLEdBQUdpRyxLQUFLTSxLQUN6QmhHLEVBQUEsRUFBU04sZUFBZWdHLEtBQUtNLEVBQVlqRyxRQUFRLFNBQVUsWUFGaEUsSUFRSTZGLEVBQUFsSCxVQUFBb0gsWUFBUixXQVFJLElBUkosSUFLUXBGLEVBQ0FvRyxFQU5SL0QsRUFBQXpCLEtBQ1F5RixFQUFvQ3BFLFNBQVNDLGlCQUM3QyxpQkFNSzNGLEVBQUksRUFBSXlELEVBQVVxRyxFQUFhOUosR0FBS0EsSUFDekM2SixFQUFjcEcsRUFBUTRDLFFBQVFoQyxLQUFLQyxxQkFBcUJuQixNQUNwREosRUFBQSxFQUFTZixZQUdieUIsRUFBUTRDLFFBQVExQixPQUNYeEIsTUFBTUosRUFBQSxFQUFTYixnQkFDZjBFLFFBQVEsU0FBQWpDLEdBQ0xtQixFQUFLbkIsT0FBT2tGLEVBQVksR0FBSWxGLEVBQVFsQixNQUl4RGtGLEVBaklBIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFtdLCBmYWN0b3J5KTtcblx0ZWxzZSB7XG5cdFx0dmFyIGEgPSBmYWN0b3J5KCk7XG5cdFx0Zm9yKHZhciBpIGluIGEpICh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgPyBleHBvcnRzIDogcm9vdClbaV0gPSBhW2ldO1xuXHR9XG59KSh3aW5kb3csIGZ1bmN0aW9uKCkge1xucmV0dXJuICIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbiBcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG4gXHRcdFx0XHRnZXQ6IGdldHRlclxuIFx0XHRcdH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gNCk7XG4iLCJleHBvcnQgY29uc3QgcGF0dGVybnMgPSB7XG4gICAga2V5VHlwZUFycmF5OiAvXFxbXFxzKihcXGQrKVxccypcXF0rL2csXG4gICAgcGFyYW1zOiAvXFx7XFxzKihcXGQrKVxccypcXH0rL2csXG4gICAgc3BsaXRRdWVyeTogL1xccytpblxccysvLFxuICAgIGZpbmRUZW1wbGF0ZVZhcnM6IC9cXHtcXHtcXHMqKFtcXFtcXF1cXCRcXC5cXF8wLTlhLXpBLVpdKylcXHMqXFx9XFx9L2csXG4gICAgc3BsaXRRdWVyeVZhcnM6IC9cXHMqLFxccyovLFxuICAgIGlzQXJyYXlTaW50YXg6IHtcbiAgICAgICAgaW5pOiAvKD89XlxccypcXFspLyxcbiAgICAgICAgZW5kOiAvKD89XFxdXFxzKiQpL1xuICAgIH0sXG4gICAgZmlsdGVyczoge1xuICAgICAgICBsaWtlOiAvXFxzK2xpa2VcXHMrLyxcbiAgICAgICAgYXM6IC9cXHMrYXNcXHMrL1xuICAgIH0sXG4gICAgaGFzU2VsZWN0b3JDc3M6IC9eKCN8XFwuKVxcUy9cbn07XG4iLCJpbXBvcnQgeyBwYXR0ZXJucyB9IGZyb20gJy4vcGF0dGVybnMnO1xuXG5leHBvcnQgY2xhc3MgSGVscGVycyB7XG4gICAgLyoqXG4gICAgICogSW5qZWN0b3IgZGUgZGF0b3MgZGVudHJvIGRlIHVuIHRlbXBsYXRlXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAbWV0aG9kXG4gICAgICovXG4gICAgc3RhdGljIHJlbmRlclRlbXBsYXRlKHRlbXBsYXRlLCBkYXRhKSB7XG4gICAgICAgIHJldHVybiB0ZW1wbGF0ZVxuICAgICAgICAgICAgLnJlcGxhY2UocGF0dGVybnMua2V5VHlwZUFycmF5LCAnLiQxJylcbiAgICAgICAgICAgIC5yZXBsYWNlKHBhdHRlcm5zLmZpbmRUZW1wbGF0ZVZhcnMsIChmaW5kLCBrZXkpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgcGFydHNLZXkgPSBrZXkuc3BsaXQoJy4nKTtcbiAgICAgICAgICAgICAgICBsZXQgZmluZGVyID0gZGF0YVtwYXJ0c0tleVswXV07XG5cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpZHggPSAxOyBpZHggPCBwYXJ0c0tleS5sZW5ndGg7IGlkeCsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbmRlciA9IGZpbmRlcltwYXJ0c0tleVtpZHhdXTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoZmluZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmaW5kZXI7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbmQ7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzdGF0aWMgaW5zZXJ0QWZ0ZXIoaW5zZXJ0RWxlbWVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZWxlbWVudC5uZXh0U2libGluZykge1xuICAgICAgICAgICAgZWxlbWVudC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShpbnNlcnRFbGVtZW50LCBlbGVtZW50Lm5leHRTaWJsaW5nKTtcblxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgZWxlbWVudC5wYXJlbnROb2RlLmFwcGVuZENoaWxkKGluc2VydEVsZW1lbnQpO1xuICAgIH1cblxuICAgIHN0YXRpYyBpc09mVHlwZShkYXRhLCBjb21wYXJlKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICB7fS50b1N0cmluZ1xuICAgICAgICAgICAgICAgIC5jYWxsKGRhdGEpXG4gICAgICAgICAgICAgICAgLm1hdGNoKC9cXHMoLispXFxdJC8pWzFdXG4gICAgICAgICAgICAgICAgLnRvTG93ZXJDYXNlKCkgPT09IGNvbXBhcmVcbiAgICAgICAgKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBwYXR0ZXJucyB9IGZyb20gJy4vcGF0dGVybnMnO1xuaW1wb3J0IHsgRmlsdGVyIH0gZnJvbSAnLi9maWx0ZXInO1xuaW1wb3J0IHsgSGVscGVycyB9IGZyb20gJy4vaGVscGVycyc7XG5cbmV4cG9ydCBjbGFzcyBSZXBlYXRIdG1sIHtcbiAgICBmaWx0ZXI6IEZpbHRlcjtcbiAgICBvcmlnaW5hbEVsZW1lbnRzOiBhbnk7XG4gICAgcmVwZWF0QXR0cmlidXRlTmFtZTogc3RyaW5nO1xuICAgIHNlbGVjdG9yOiBzdHJpbmc7XG4gICAgX3Njb3BlOiBhbnk7XG5cbiAgICBjb25zdHJ1Y3Rvcihjb25maWc6IGFueSA9IHt9KSB7XG4gICAgICAgIHRoaXMucmVwZWF0QXR0cmlidXRlTmFtZSA9IGNvbmZpZy5hdHRyTmFtZSB8fCAncmVwZWF0JztcbiAgICAgICAgdGhpcy5fc2NvcGUgPSBjb25maWcuc2NvcGUgfHwge307XG4gICAgICAgIHRoaXMub3JpZ2luYWxFbGVtZW50cyA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5maWx0ZXIgPSBuZXcgRmlsdGVyKFxuICAgICAgICAgICAgdGhpcy5fc2NvcGUsXG4gICAgICAgICAgICB0aGlzLnJlcGVhdEF0dHJpYnV0ZU5hbWUsXG4gICAgICAgICAgICB0aGlzLnJlZnJlc2guYmluZCh0aGlzKVxuICAgICAgICApO1xuXG4gICAgICAgIHRoaXMuc2VsZWN0b3IgPSAnW2RhdGEtJyArIHRoaXMucmVwZWF0QXR0cmlidXRlTmFtZSArICddJztcblxuICAgICAgICBpZiAoY29uZmlnLmNvbXBpbGUgfHwgY29uZmlnLmNvbXBpbGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5pbml0KGZhbHNlLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNZXRvZG8gZGUgZW50cmFkYSBvIHNhbGlkYSBkZSBkYXRvcyBkZWwgX3Njb3BlXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBtZXRob2RcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2YXJOYW1lIC0gTm9tYnJlIGRlbCBkYXRvIGEgYWxtYWNlbmFyIGRlbnRybyBkZWwgc2NvcGVcbiAgICAgKiBAcGFyYW0ge2FueVtdfSBkYXRhIC0gSW5mb3JtYWNpb24gbyBkYXRvcyBhIGFsbWFjZW5hclxuICAgICAqIEBwYXJhbSB7T2JqZWN0fEZ1bmN0aW9ufEFycmF5fSBmdW5jQmFja3MgLSBGdW5jaW9uZXMgcXVlIHNlIGVqZWN1dGFyYW4gYWwgYWN0dWFsaXphciBlbCBtb2RlbG8gZGUgZGF0b3NcbiAgICAgKi9cbiAgICBzY29wZSh2YXJOYW1lOiBzdHJpbmcsIGRhdGEsIGZ1bmNCYWNrcz8pIHtcbiAgICAgICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Njb3BlW3Zhck5hbWVdO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fc2NvcGVbdmFyTmFtZV0gPSB0aGlzLl9zY29wZVt2YXJOYW1lXSB8fCB7fTtcbiAgICAgICAgdGhpcy5fc2NvcGVbdmFyTmFtZV0uZGF0YSA9IGRhdGE7XG4gICAgICAgIHRoaXMuX3Njb3BlW3Zhck5hbWVdLm9yaWdpbmFsRGF0YSA9IGRhdGE7XG5cbiAgICAgICAgaWYgKHR5cGVvZiBmdW5jQmFja3MgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHRoaXMuX3Njb3BlW3Zhck5hbWVdLmZ1bmNCYWNrQWZ0ZXIgPSBmdW5jQmFja3M7XG4gICAgICAgIH0gZWxzZSBpZiAoSGVscGVycy5pc09mVHlwZShmdW5jQmFja3MsICdhcnJheScpKSB7XG4gICAgICAgICAgICB0aGlzLl9zY29wZVt2YXJOYW1lXS5mdW5jQmFja0FmdGVyID0gZnVuY0JhY2tzWzBdO1xuICAgICAgICAgICAgdGhpcy5fc2NvcGVbdmFyTmFtZV0uZnVuY0JhY2sgPSBmdW5jQmFja3NbMV07XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGZ1bmNCYWNrcyA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIHRoaXMuX3Njb3BlW3Zhck5hbWVdLmZ1bmNCYWNrQWZ0ZXIgPSBmdW5jQmFja3MuYWZ0ZXI7XG4gICAgICAgICAgICB0aGlzLl9zY29wZVt2YXJOYW1lXS5mdW5jQmFjayA9IGZ1bmNCYWNrcy5mdW5jQmFjaztcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucmVmcmVzaCh2YXJOYW1lKTtcblxuICAgICAgICBpZiAodGhpcy5fc2NvcGVbdmFyTmFtZV0uZnVuY0JhY2tBZnRlcikge1xuICAgICAgICAgICAgdGhpcy5fc2NvcGVbdmFyTmFtZV0uZnVuY0JhY2tBZnRlci5jYWxsKHRoaXMsIGRhdGEpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXBsaWNhciBhY2Npb24gZGUgcmVwZXRpclxuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAbWV0aG9kXG4gICAgICovXG4gICAgcmVmcmVzaCh2YXJOYW1lLCBlbGVtZW50Pykge1xuICAgICAgICBsZXQgaGFzRGF0YVJlcGVhdEF0dHJpYnV0ZSA9XG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuc2VsZWN0b3IpLmxlbmd0aCA+IDA7XG5cbiAgICAgICAgaWYgKGhhc0RhdGFSZXBlYXRBdHRyaWJ1dGUpIHtcbiAgICAgICAgICAgIHRoaXMuaW5pdChmYWxzZSwgZmFsc2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yZVJlbmRlcih2YXJOYW1lLCBlbGVtZW50KTtcblxuICAgICAgICAvL2NsZWFyKCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlcGl0YWRvIGRlIGxvcyBkYXRvc1xuICAgICAqIEBwcml2YXRlXG4gICAgICogQG1ldGhvZFxuICAgICAqL1xuICAgIHJlUmVuZGVyKHZhck5hbWUsIGVsZW1lbnQpIHtcbiAgICAgICAgbGV0IGVsZW1lbnRzID0gdGhpcy5vcmlnaW5hbEVsZW1lbnRzO1xuICAgICAgICBsZXQgcmVwZWF0RGF0YSA9IG51bGw7XG4gICAgICAgIGxldCBlbGVtZW50RGF0YTtcbiAgICAgICAgbGV0IGVsZW1lbnRzUmVwZWF0Q29udGVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcblxuICAgICAgICBsZXQgZnVuY0JhY2tBcmdzID0gW107XG4gICAgICAgIGxldCBtb2RlbERhdGEgPSB0aGlzLl9zY29wZVt2YXJOYW1lXTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBlbGVtZW50RGF0YSA9IGVsZW1lbnRzW2ldO1xuXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgZWxlbWVudCAmJlxuICAgICAgICAgICAgICAgIGVsZW1lbnQuZGF0YXNldC5maWx0ZXIgIT09IGVsZW1lbnREYXRhLmVsZW1lbnQuZGF0YXNldC5maWx0ZXJcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXBlYXREYXRhID0gdGhpcy5yZXNvbHZlUXVlcnkoXG4gICAgICAgICAgICAgICAgZWxlbWVudERhdGEuZWxlbWVudC5kYXRhc2V0W3RoaXMucmVwZWF0QXR0cmlidXRlTmFtZV1cbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmICghcmVwZWF0RGF0YS5kYXRhcyB8fCB2YXJOYW1lICE9PSByZXBlYXREYXRhLnZhck5hbWUpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IGVsZW1lbnRIVE1MID0gZWxlbWVudERhdGEuZWxlbWVudC5pbm5lckhUTUw7XG5cbiAgICAgICAgICAgIGVsZW1lbnREYXRhLmNoaWxkcy5mb3JFYWNoKChjaGlsZCwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGVsZW1lbnREYXRhLnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQoY2hpbGQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnREYXRhLmNoaWxkcy5zcGxpY2UoMSwgZWxlbWVudERhdGEuY2hpbGRzLmxlbmd0aCk7XG5cbiAgICAgICAgICAgIHJlcGVhdERhdGEuZGF0YXMuZm9yRWFjaChkYXRhID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgZWxlbWVudENsb24gPSBlbGVtZW50RGF0YS5lbGVtZW50Q2xvbmUuY2xvbmVOb2RlKGZhbHNlKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnRDbG9uLmlubmVySFRNTCA9IEhlbHBlcnMucmVuZGVyVGVtcGxhdGUoZWxlbWVudEhUTUwsIHtcbiAgICAgICAgICAgICAgICAgICAgW3JlcGVhdERhdGEudmFyc0l0ZXJhdGVdOiBkYXRhXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50c1JlcGVhdENvbnRlbnQuYXBwZW5kQ2hpbGQoZWxlbWVudENsb24pO1xuICAgICAgICAgICAgICAgIGVsZW1lbnREYXRhLmNoaWxkcy5wdXNoKGVsZW1lbnRDbG9uKTtcblxuICAgICAgICAgICAgICAgIGlmIChtb2RlbERhdGEuZnVuY0JhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgZnVuY0JhY2tBcmdzLnB1c2goW2RhdGEsIGVsZW1lbnRDbG9uXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIEhlbHBlcnMuaW5zZXJ0QWZ0ZXIoZWxlbWVudHNSZXBlYXRDb250ZW50LCBlbGVtZW50RGF0YS5jaGlsZHNbMF0pO1xuICAgICAgICAgICAgZWxlbWVudHNSZXBlYXRDb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCEhdmFyTmFtZSAmJiBtb2RlbERhdGEuZnVuY0JhY2spIHtcbiAgICAgICAgICAgIGZ1bmNCYWNrQXJncy5mb3JFYWNoKGFyZ3MgPT4ge1xuICAgICAgICAgICAgICAgIG1vZGVsRGF0YS5mdW5jQmFjay5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWV0b2RvIGRlIGVudHJhZGEgbyBzYWxpZGEgZGVsIHNjb3BlXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAbWV0aG9kXG4gICAgICovXG4gICAgaW5pdChpc1JlZnJlc2gsIGZpbmRQYXJlbnRzKSB7XG4gICAgICAgIGxldCBlbGVtZW50czogYW55ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0b3IgKyAoZmluZFBhcmVudHMgPyAnJyA6ICcgJyArIHRoaXMuc2VsZWN0b3IpXG4gICAgICAgICk7XG4gICAgICAgIGxldCBlbGVtZW50ID0gbnVsbDtcbiAgICAgICAgbGV0IHJlcGVhdERhdGEgPSBudWxsO1xuICAgICAgICBsZXQgbGVuRWxlbWVudHMgPSAwO1xuICAgICAgICBsZXQgZWxlbWVudHNSZXBlYXRDb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuXG4gICAgICAgIGlmICghdGhpcy5vcmlnaW5hbEVsZW1lbnRzKSB7XG4gICAgICAgICAgICB0aGlzLm9yaWdpbmFsRWxlbWVudHMgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGVsZW1lbnQgPSBlbGVtZW50c1tpXS5lbGVtZW50IHx8IGVsZW1lbnRzW2ldO1xuXG4gICAgICAgICAgICByZXBlYXREYXRhID0gdGhpcy5yZXNvbHZlUXVlcnkoXG4gICAgICAgICAgICAgICAgZWxlbWVudC5kYXRhc2V0W3RoaXMucmVwZWF0QXR0cmlidXRlTmFtZV1cbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmICghcmVwZWF0RGF0YS5kYXRhcykge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsZXQgZWxlbWVudEh0bWwgPSBlbGVtZW50LmlubmVySFRNTDtcblxuICAgICAgICAgICAgbGV0IGVsZW1lbnRDb3B5ID0gZWxlbWVudC5jbG9uZU5vZGUodHJ1ZSksXG4gICAgICAgICAgICAgICAgY29tbWVudFN0YXJ0ID0gZG9jdW1lbnQuY3JlYXRlQ29tbWVudChcbiAgICAgICAgICAgICAgICAgICAgJ1JlcGVhdEhUTUw6IHN0YXJ0KCAnICtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZGF0YXNldFt0aGlzLnJlcGVhdEF0dHJpYnV0ZU5hbWVdICtcbiAgICAgICAgICAgICAgICAgICAgICAgICcgKSdcbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBlbGVtZW50Q29weS5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtJyArIHRoaXMucmVwZWF0QXR0cmlidXRlTmFtZSk7XG4gICAgICAgICAgICBlbGVtZW50Q29weS5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtZmlsdGVyJyk7XG5cbiAgICAgICAgICAgIGlmICghaXNSZWZyZXNoKSB7XG4gICAgICAgICAgICAgICAgLy9BbG1hY2VuYXIgY2FkYSBlbGVtZW50byBvcmlnaW5hbCBlbiB1bmEgYXJyZWdsb1xuICAgICAgICAgICAgICAgIHRoaXMub3JpZ2luYWxFbGVtZW50cy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudC5jbG9uZU5vZGUodHJ1ZSksXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRDbG9uZTogZWxlbWVudENvcHksXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudEVsZW1lbnQ6IGVsZW1lbnQucGFyZW50RWxlbWVudCxcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRzOiBbY29tbWVudFN0YXJ0XVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgbGVuRWxlbWVudHMgPSB0aGlzLm9yaWdpbmFsRWxlbWVudHMubGVuZ3RoO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50c1JlcGVhdENvbnRlbnQuYXBwZW5kQ2hpbGQoY29tbWVudFN0YXJ0KTtcblxuICAgICAgICAgICAgLy9Db21lbnRhcmlvIGRlbGltaXRhZG9yIGRlIGluaWNpb1xuICAgICAgICAgICAgcmVwZWF0RGF0YS5kYXRhcy5mb3JFYWNoKGRhdGEgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBlbGVtZW50Q2xvbmVkID0gZWxlbWVudENvcHkuY2xvbmVOb2RlKGZhbHNlKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnRDbG9uZWQuaW5uZXJIVE1MID0gSGVscGVycy5yZW5kZXJUZW1wbGF0ZShlbGVtZW50SHRtbCwge1xuICAgICAgICAgICAgICAgICAgICBbcmVwZWF0RGF0YS52YXJzSXRlcmF0ZV06IGRhdGFcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnRzUmVwZWF0Q29udGVudC5hcHBlbmRDaGlsZChlbGVtZW50Q2xvbmVkKTtcblxuICAgICAgICAgICAgICAgIGlmICghaXNSZWZyZXNoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3JpZ2luYWxFbGVtZW50c1tsZW5FbGVtZW50cyAtIDFdLmNoaWxkcy5wdXNoKFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudENsb25lZFxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBlbGVtZW50LnBhcmVudEVsZW1lbnQucmVwbGFjZUNoaWxkKGVsZW1lbnRzUmVwZWF0Q29udGVudCwgZWxlbWVudCk7XG4gICAgICAgICAgICBlbGVtZW50c1JlcGVhdENvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoXG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuc2VsZWN0b3IpLmxlbmd0aCA+IDAgJiZcbiAgICAgICAgICAgICFmaW5kUGFyZW50c1xuICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmluaXQoaXNSZWZyZXNoLCB0cnVlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc3VlbHZlIGxhIGNhZGVuYSBkZSB0ZXh0byBkZWwgcmVwZWF0IGEgZG9zIHByb3BpZWRhZGVzXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAbWV0aG9kXG4gICAgICovXG4gICAgcmVzb2x2ZVF1ZXJ5KHF1ZXJ5KSB7XG4gICAgICAgIHF1ZXJ5ID0gcXVlcnkuc3BsaXQocGF0dGVybnMuc3BsaXRRdWVyeSk7XG5cbiAgICAgICAgaWYgKHF1ZXJ5WzBdLnRyaW0oKSA9PT0gJycgJiYgIXF1ZXJ5WzFdKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHZhcnNJdGVyYXRlOiBudWxsLFxuICAgICAgICAgICAgICAgIGRhdGFzOiBudWxsLFxuICAgICAgICAgICAgICAgIHZhck5hbWU6IG51bGxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdmFyc0l0ZXJhdGU6IHF1ZXJ5WzBdLnNwbGl0KHBhdHRlcm5zLnNwbGl0UXVlcnlWYXJzKSxcbiAgICAgICAgICAgIGRhdGFzOiB0aGlzLnBhcnNlRGF0YS5jYWxsKHRoaXMsIHF1ZXJ5WzFdLnRyaW0oKSksXG4gICAgICAgICAgICB2YXJOYW1lOiBxdWVyeVsxXS50cmltKClcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb2RpZmljYSBsb3MgZGF0b3MgZGUgZW50cmFkYSBkZXBlbmRpZW5kbyBkZWwgdGlwbywgYXJyYXkgbyBzdHJpbmdcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBtZXRob2RcbiAgICAgKi9cbiAgICBwYXJzZURhdGEoc3RyRGF0YSkge1xuICAgICAgICBpZiAodGhpcy5fc2NvcGVbc3RyRGF0YV0pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbHRlci5hcHBseShzdHJEYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIHBhdHRlcm5zLmlzQXJyYXlTaW50YXguaW5pLnRlc3Qoc3RyRGF0YSkgJiZcbiAgICAgICAgICAgIHBhdHRlcm5zLmlzQXJyYXlTaW50YXguZW5kLnRlc3Qoc3RyRGF0YSlcbiAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm4gZXZhbChzdHJEYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IHBhdHRlcm5zIH0gZnJvbSAnLi9wYXR0ZXJucyc7XG5cbmV4cG9ydCBjbGFzcyBGaWx0ZXIge1xuICAgIHByb3RlY3RlZCBjYWxsYmFjazogRnVuY3Rpb247XG4gICAgcHJvdGVjdGVkIHNjb3BlOiBhbnk7XG4gICAgcHJvdGVjdGVkIHJlcGVhdEF0dHJpYnV0ZU5hbWU6IHN0cmluZztcbiAgICBwcm90ZWN0ZWQgZmlsdGVycztcblxuICAgIGNvbnN0cnVjdG9yKHNjb3BlLCByZXBlYXRBdHRyaWJ1dGVOYW1lOiBzdHJpbmcsIGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuc2NvcGUgPSBzY29wZTtcbiAgICAgICAgdGhpcy5yZXBlYXRBdHRyaWJ1dGVOYW1lID0gcmVwZWF0QXR0cmlidXRlTmFtZTtcbiAgICAgICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgICAgICB0aGlzLmZpbHRlcnMgPSB7fTtcblxuICAgICAgICB0aGlzLmZpbmRGaWx0ZXJzKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmlsdHJhciBsYSBsaXN0YSBkZSBkYXRvcyBkZXBlbmRpZW5kbyBkZWwgcGFyYW1ldHJvIGRhZG9cbiAgICAgKiBAcHVibGljXG4gICAgICogQG1ldGhvZFxuICAgICAqL1xuICAgIGFwcGx5KHZhck5hbWUpIHtcbiAgICAgICAgaWYgKCF2YXJOYW1lIHx8ICF0aGlzLmZpbHRlcnNbdmFyTmFtZV0pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNjb3BlW3Zhck5hbWVdLmRhdGE7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5zY29wZVt2YXJOYW1lXS5kYXRhLmZpbHRlcih0aGlzLmZpbHRlcnNbdmFyTmFtZV0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2YXJpYWJsZU5hbWVcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZmlsdGVyVmFsdWVcbiAgICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50XG4gICAgICogQHJldHVybnNcbiAgICAgKi9cbiAgICBmaWx0ZXIodmFyaWFibGVOYW1lOiBzdHJpbmcsIGZpbHRlclZhbHVlOiBzdHJpbmcsIGVsZW1lbnQ6IEhUTUxFbGVtZW50KSB7XG4gICAgICAgIGZpbHRlclZhbHVlID0gZmlsdGVyVmFsdWUudHJpbSgpO1xuXG4gICAgICAgIGlmICh0aGlzLnZhbGlkYXRlKHZhcmlhYmxlTmFtZSwgZmlsdGVyVmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgX2ZpbHRlciA9IGZpbHRlclZhbHVlLnNwbGl0KHBhdHRlcm5zLmZpbHRlcnMuYXMpO1xuXG4gICAgICAgIGxldCBwcm9wID0gX2ZpbHRlclswXTtcbiAgICAgICAgbGV0IHNlbGVjdG9yID0gX2ZpbHRlclsxXTtcblxuICAgICAgICBpZiAoIXNlbGVjdG9yKSB7XG4gICAgICAgICAgICBzZWxlY3RvciA9IHByb3A7XG4gICAgICAgICAgICBwcm9wID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBlbGVtOiBhbnkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcbiAgICAgICAgICAgIHNlbGVjdG9yLnJlcGxhY2UoLyN8XiV8JSQvZywgJycpXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKCFlbGVtKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgaGFzUGVyY2VudEluaXQgPSAvXiUvZy50ZXN0KHNlbGVjdG9yKSA/ICdeJyA6ICcnO1xuICAgICAgICBsZXQgaGFzUGVyY2VudEVuZCA9IC8lJC9nLnRlc3Qoc2VsZWN0b3IpID8gJyQnIDogJyc7XG5cbiAgICAgICAgZmlsdGVyVmFsdWUgPSBlbGVtLnZhbHVlOyAvL3BhcmEgbGxhbWFybG8gdW5hIHByaW1lcmEgdmV6XG5cbiAgICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGV2ZW50ID0+IHtcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IGV2ZW50LnRhcmdldC52YWx1ZTtcblxuICAgICAgICAgICAgdGhpcy5zY29wZVt2YXJpYWJsZU5hbWVdLmRhdGEgPSB0aGlzLnNjb3BlW1xuICAgICAgICAgICAgICAgIHZhcmlhYmxlTmFtZVxuICAgICAgICAgICAgXS5vcmlnaW5hbERhdGEuZmlsdGVyKGRhdGEgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBwYXR0ZXJuID0gbmV3IFJlZ0V4cChcbiAgICAgICAgICAgICAgICAgICAgaGFzUGVyY2VudEluaXQgKyB2YWx1ZSArIGhhc1BlcmNlbnRFbmQsXG4gICAgICAgICAgICAgICAgICAgICdnaSdcbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgaWYgKHByb3ApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhdHRlcm4udGVzdChkYXRhW3Byb3BdKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IF9wcm9wIGluIGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhdHRlcm4udGVzdChkYXRhW19wcm9wXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuY2FsbGJhY2sodmFyaWFibGVOYW1lLCBlbGVtZW50KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHZhcmlhYmxlTmFtZVxuICAgICAqIEBwYXJhbSBmaWx0ZXJWYWx1ZVxuICAgICAqL1xuICAgIHZhbGlkYXRlKHZhcmlhYmxlTmFtZTogc3RyaW5nLCBmaWx0ZXJWYWx1ZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh2YXJpYWJsZU5hbWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgIXBhdHRlcm5zLmZpbHRlcnMuYXMudGVzdChmaWx0ZXJWYWx1ZSkgJiZcbiAgICAgICAgICAgICFwYXR0ZXJucy5oYXNTZWxlY3RvckNzcy50ZXN0KGZpbHRlclZhbHVlLnJlcGxhY2UoL14lfCUkL2csICcnKSlcbiAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGZpbmRGaWx0ZXJzKCkge1xuICAgICAgICBsZXQgcXVlcnlGaWx0ZXJzOiBOb2RlTGlzdE9mPEVsZW1lbnQ+ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcbiAgICAgICAgICAgICdbZGF0YS1maWx0ZXJdJ1xuICAgICAgICApO1xuXG4gICAgICAgIGxldCBlbGVtZW50OiBhbnk7XG4gICAgICAgIGxldCBxdWVyeVJlcGVhdDogc3RyaW5nO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyAoZWxlbWVudCA9IHF1ZXJ5RmlsdGVyc1tpXSk7IGkrKykge1xuICAgICAgICAgICAgcXVlcnlSZXBlYXQgPSBlbGVtZW50LmRhdGFzZXRbdGhpcy5yZXBlYXRBdHRyaWJ1dGVOYW1lXS5zcGxpdChcbiAgICAgICAgICAgICAgICBwYXR0ZXJucy5zcGxpdFF1ZXJ5XG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBlbGVtZW50LmRhdGFzZXQuZmlsdGVyXG4gICAgICAgICAgICAgICAgLnNwbGl0KHBhdHRlcm5zLnNwbGl0UXVlcnlWYXJzKVxuICAgICAgICAgICAgICAgIC5mb3JFYWNoKGZpbHRlciA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyKHF1ZXJ5UmVwZWF0WzFdLCBmaWx0ZXIsIGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==